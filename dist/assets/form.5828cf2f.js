import{v as H}from"./index.c33ef0ff.js";import{v as M,a as K,f as W}from"./route.f0cba945.js";import{d as Z,r as G,al as v,u as c}from"./index.0f5ebb0a.js";import{l as R,r as p,R as Q,e as X,aa as i,ah as Y,m as I,D as O,E as t,L as l,u as o,j as V,I as d,F as ee,t as g,J as ae,n as le}from"./vue.4dfaac09.js";const re=g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 13.5V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m12-3V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m-6-9V3.75m0 3.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 9.75V10.5"})],-1),te=g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m6.75 7.5 3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0 0 21 18V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v12a2.25 2.25 0 0 0 2.25 2.25Z"})],-1),oe={class:"flex items-center justify-center mt-4"},se=R({name:"routeForm"}),ue=R({...se,emits:["refresh"],setup(ie,{expose:k,emit:C}){const U=C,{t:q}=Z(),h=p("first"),f=p(!1),b=p(!1),m=p({}),y=p(),_=p("1"),r=p({routeId:"",routeName:"",path:"",sortOrder:0,serviceName:"",timeout:3e4,burstCapacity:1e5,replenishRate:1e4,cors:!1}),P=Q({routeId:new Date().getTime(),routeName:"\u8DEF\u7531\u540D\u79F0",predicates:[{args:{_genkey_0:"/\u8DEF\u7531\u524D\u7F00/**"},name:"Path"}],filters:[],uri:"lb://\u670D\u52A1\u540D\u79F0",sortOrder:0,metadata:{}}),A=p({routeId:[{required:!0,message:"\u8DEF\u7531\u6807\u8BC6\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:(a,e,u)=>{M(a,e,u,N.value)},trigger:"blur"},{min:3,max:64,message:"\u957F\u5EA6\u5728 3 \u5230 64 \u4E2A\u5B57\u7B26",trigger:"blur"}],routeName:[{required:!0,message:"\u8DEF\u7531\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:3,max:64,message:"\u957F\u5EA6\u5728 3 \u5230 64 \u4E2A\u5B57\u7B26",trigger:"blur"}],path:[{required:!0,message:"\u8DEF\u7531\u524D\u7F00\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:G.validatorLower,trigger:"blur"},{min:3,max:64,message:"\u957F\u5EA6\u5728 3 \u5230 64 \u4E2A\u5B57\u7B26",trigger:"blur"}],serviceName:[{required:!0,message:"\u76EE\u6807\u670D\u52A1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:3,max:64,message:"\u957F\u5EA6\u5728 3 \u5230 64 \u4E2A\u5B57\u7B26",trigger:"blur"}],sortOrder:[{required:!0,message:"\u6392\u5E8F\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]});X(r,a=>{m.value={routeId:a.routeId,routeName:a.routeName,sortOrder:a.sortOrder,predicates:[{args:{_genkey_0:`/${a.path}/**`},name:"Path"}],uri:`lb://${a.serviceName}`,metadata:{"response-timeout":a.timeout,...a.cors?{cors:{allowedOrigins:"*",allowedMethods:"*",allowedHeaders:"*",allowedCredentials:!0}}:{}},filters:[{name:"RequestRateLimiter",args:{"redis-rate-limiter.replenishRate":a.replenishRate,"redis-rate-limiter.burstCapacity":a.burstCapacity,"key-resolver":"#{@remoteAddrKeyResolver}"}}]}},{deep:!0});const w=a=>{r.value.routeId=a.routeId,r.value.routeName=a.routeName,r.value.sortOrder=a.sortOrder,a.predicates.forEach(e=>{e.name==="Path"&&(r.value.path=e.args._genkey_0.replace("/**","").replace("/",""))}),r.value.serviceName=a.uri.replace("lb://",""),a.filters.forEach(e=>{e.name==="RequestRateLimiter"&&(r.value.replenishRate=e.args["redis-rate-limiter.replenishRate"],r.value.burstCapacity=e.args["redis-rate-limiter.burstCapacity"])}),r.value.timeout=a.metadata["response-timeout"],r.value.cors=!!a.metadata.cors,m.value=a},j=async()=>{b.value=!0;try{if(!await y.value.validate().catch(()=>{}))return!1;if(!(a=>{if(!a.predicates||!Array.isArray(a.predicates)||a.predicates.length===0)return c().error("\u8DEF\u7531\u524D\u7F00\u914D\u7F6E\u4E0D\u5408\u6CD5"),!1;if(!a.predicates.find(e=>e.name==="Path"))return c().error("\u8DEF\u7531\u914D\u7F6E\u4E2D\u5FC5\u987B\u5305\u542B Path \u89C4\u5219"),!1;if(!a.uri||typeof a.uri!="string"||!a.uri.startsWith("lb://"))return c().error("\u76EE\u6807\u670D\u52A1\u4E0D\u5408\u6CD5"),!1;if(a.filters&&Array.isArray(a.filters)){const e=a.filters.find(u=>u.name==="RequestRateLimiter");if(e&&e.args["redis-rate-limiter.burstCapacity"]<1e3)return c().error("\u603B\u6570\u9650\u5236\u4E0D\u80FD\u5C0F\u4E8E1000"),!1}return!0})(m.value))return b.value=!1,!1;await K(m.value),c().success(q("common.optSuccessText")),f.value=!1}catch(a){c().error(a.msg)}finally{b.value=!1,U("refresh")}},N=p();return k({openDialog:async a=>{N.value=a,f.value=!0,le(()=>{var e;(e=y.value)==null||e.resetFields()}),a?await(async e=>{const u=(await W({routeId:e})).data[0];return u.predicates&&(u.predicates=JSON.parse(u.predicates)),u.filters&&(u.filters=JSON.parse(u.filters)),u.metadata&&(u.metadata=JSON.parse(u.metadata)),u})(a).then(e=>{m.value=e,w(e)}):m.value=P}}),(a,e)=>{const u=i("el-input"),n=i("el-form-item"),L=i("info-filled"),D=i("el-icon"),E=i("el-switch"),F=i("el-collapse-item"),J=i("el-collapse"),S=i("el-form"),x=i("el-tab-pane"),z=i("el-tabs"),B=i("el-button"),T=i("el-drawer"),$=Y("loading");return I(),O(T,{title:"\u8DEF\u7531\u914D\u7F6E",size:"40%",modelValue:o(f),"onUpdate:modelValue":e[12]||(e[12]=s=>V(f)?f.value=s:null)},{default:t(()=>[l(z,{modelValue:o(h),"onUpdate:modelValue":e[11]||(e[11]=s=>V(h)?h.value=s:null)},{default:t(()=>[l(x,{label:"\u57FA\u7840\u6A21\u5F0F",name:"first"},{label:t(()=>[re,d(" \u57FA\u7840\u6A21\u5F0F ")]),default:t(()=>[ee((I(),O(S,{model:o(r),rules:o(A),"label-width":"100px",ref_key:"dataFormRef",ref:y},{default:t(()=>[l(n,{label:"\u8DEF\u7531ID",prop:"routeId"},{default:t(()=>[l(u,{clearable:"",modelValue:o(r).routeId,"onUpdate:modelValue":e[0]||(e[0]=s=>o(r).routeId=s)},null,8,["modelValue"])]),_:1}),l(n,{label:"\u8DEF\u7531\u540D\u79F0",prop:"routeName"},{default:t(()=>[l(u,{clearable:"",modelValue:o(r).routeName,"onUpdate:modelValue":e[1]||(e[1]=s=>o(r).routeName=s)},null,8,["modelValue"])]),_:1}),l(n,{label:"\u8DEF\u7531\u524D\u7F00",prop:"path"},{label:t(()=>[d(" \u8DEF\u7531\u524D\u7F00 "),l(v,{content:"\u8BBF\u95EE\u5FAE\u670D\u52A1\u7684\u516C\u5171\u524D\u7F00 "})]),default:t(()=>[l(u,{clearable:"",modelValue:o(r).path,"onUpdate:modelValue":e[2]||(e[2]=s=>o(r).path=s)},{prepend:t(()=>[d("/")]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"\u76EE\u6807\u670D\u52A1",prop:"serviceName"},{label:t(()=>[d(" \u76EE\u6807\u670D\u52A1 "),l(v,{content:"\u6CE8\u518C\u5230\u6CE8\u518C\u4E2D\u5FC3\u5BF9\u5E94\u7684\u670D\u52A1\u540D\u79F0 "})]),default:t(()=>[l(u,{clearable:"",modelValue:o(r).serviceName,"onUpdate:modelValue":e[3]||(e[3]=s=>o(r).serviceName=s)},null,8,["modelValue"])]),_:1}),l(J,{modelValue:o(_),"onUpdate:modelValue":e[9]||(e[9]=s=>V(_)?_.value=s:null)},{default:t(()=>[l(F,{name:"1",title:"\u5B89\u5168\u5C5E\u6027"},{title:t(()=>[l(D,{class:"header-icon"},{default:t(()=>[l(L)]),_:1}),d(" \u9AD8\u7EA7\u5C5E\u6027 ")]),default:t(()=>[l(n,{label:"\u5141\u8BB8\u8DE8\u57DF",prop:"cors"},{default:t(()=>[l(E,{modelValue:o(r).cors,"onUpdate:modelValue":e[4]||(e[4]=s=>o(r).cors=s),"active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1}),l(n,{label:"\u8D85\u65F6\u65F6\u95F4",prop:"timeout"},{default:t(()=>[l(u,{type:"number",clearable:"",modelValue:o(r).timeout,"onUpdate:modelValue":e[5]||(e[5]=s=>o(r).timeout=s)},{suffix:t(()=>[d("\u6BEB\u79D2")]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"IP\u9650\u5236",prop:"replenishRate"},{label:t(()=>[d(" IP\u9650\u5236 "),l(v,{content:"\u6BCF\u4E2AIP\u6BCF\u79D2\u6700\u5927\u8BF7\u6C42\u591A\u5C11\u6B21 "})]),default:t(()=>[l(u,{type:"number",clearable:"",modelValue:o(r).replenishRate,"onUpdate:modelValue":e[6]||(e[6]=s=>o(r).replenishRate=s)},{suffix:t(()=>[d("\u6B21/\u79D2")]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"\u603B\u6570\u9650\u5236",prop:"timeout"},{label:t(()=>[d(" \u603B\u6570\u9650\u5236 "),l(v,{content:"\u5F53\u524D\u670D\u52A1\u5668\u6BCF\u79D2\u6700\u5927\u7684\u8BF7\u6C42\u6570\u91CF"})]),default:t(()=>[l(u,{type:"number",min:1e3,clearable:"",modelValue:o(r).burstCapacity,"onUpdate:modelValue":e[7]||(e[7]=s=>o(r).burstCapacity=s)},{suffix:t(()=>[d("\u6B21/\u79D2")]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"\u4F18\u5148\u7EA7",prop:"sortOrder"},{default:t(()=>[l(u,{type:"number",clearable:"",modelValue:o(r).sortOrder,"onUpdate:modelValue":e[8]||(e[8]=s=>o(r).sortOrder=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model","rules"])),[[$,o(b)]])]),_:1}),l(x,{label:"\u7F16\u7801\u6A21\u5F0F",name:"second"},{label:t(()=>[te,d(" \u7F16\u7801\u6A21\u5F0F ")]),default:t(()=>[l(o(H),{ref:"jsonEditorRef",modelValue:o(m),"onUpdate:modelValue":e[10]||(e[10]=s=>V(m)?m.value=s:null),codec:"",onChange:w},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),g("div",oe,[l(B,{type:"primary",onClick:j,disabled:o(b)},{default:t(()=>[d(ae(a.$t("common.confirmButtonText")),1)]),_:1},8,["disabled"])])]),_:1},8,["modelValue"])}}});export{ue as default};
