import{r as D,a as j,b as K,c as R}from"./index.f675f2a1.js";import{a7 as L,g as V,r as l,R as d,h as q,m as H,q as $,t as c,z as P,F,M as X,K as Y,$ as _,J as A,n as E}from"./vue.4dfaac09.js";import{_ as G}from"./index.0f5ebb0a.js";const Q={name:"VerifyPoints",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(B){const{mode:u,captchaType:v}=L(B),{proxy:e}=V();let o=l(""),f=l(3),i=d([]),t=d([]),n=l(1),I=l(""),S=d([]),g=l(""),h=d({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),m=d([]),p=l(""),y=l(void 0),b=l(void 0),O=l(!0),z=l(!0);const J=()=>{i.splice(0,i.length),t.splice(0,t.length),n.value=1,T(),E(()=>{let{imgHeight:r,imgWidth:s,barHeight:a,barWidth:W}=D(e);h.imgHeight=r,h.imgWidth=s,h.barHeight=a,h.barWidth=W,e.$parent.$emit("ready",e)})};q(()=>{J(),e.$el.onselectstart=function(){return!1}});const x=l(null),k=function(r,s){return{x:s.offsetX,y:s.offsetY}},C=function(r){return m.push(Object.assign({},r)),n.value+1},w=function(){m.splice(0,m.length),y.value="#000",b.value="#ddd",z.value=!0,i.splice(0,i.length),t.splice(0,t.length),n.value=1,T(),p.value="\u9A8C\u8BC1\u5931\u8D25",O.value=!0};function T(){let r={captchaType:v.value};R(r).then(s=>{let a=s.data;a.repCode=="0000"?(I.value=a.repData.originalImageBase64,g.value=a.repData.token,o.value=a.repData.secretKey,S.value=a.repData.wordList,p.value="\u8BF7\u4F9D\u6B21\u70B9\u51FB\u3010"+S.value.join(",")+"\u3011"):p.value=a.repMsg})}const N=function(r,s){return r.map(a=>({x:Math.round(310*a.x/parseInt(s.imgWidth)),y:Math.round(155*a.y/parseInt(s.imgHeight))}))};return{secretKey:o,checkNum:f,fontPos:i,checkPosArr:t,num:n,pointBackImgBase:I,poinTextList:S,backToken:g,setSize:h,tempPoints:m,text:p,barAreaColor:y,barAreaBorderColor:b,showRefresh:O,bindingClick:z,init:J,canvas:x,canvasClick:r=>{if(t.push(k(x,r)),n.value==f.value){n.value=C(k(x,r));let s=N(t,h);t.length=0,t.push(...s),setTimeout(()=>{var a=o.value?j(g.value+"---"+JSON.stringify(t),o.value):g.value+"---"+JSON.stringify(t);let W={captchaType:v.value,pointJson:o.value?j(JSON.stringify(t),o.value):JSON.stringify(t),token:g.value};K(W).then(M=>{M.data.repCode=="0000"?(y.value="#4cae4c",b.value="#5cb85c",p.value="\u9A8C\u8BC1\u6210\u529F",z.value=!1,u.value=="pop"&&setTimeout(()=>{e.$parent.clickShow=!1,w()},1500),e.$parent.$emit("success",{captchaVerification:a})):(e.$parent.$emit("error",e),y.value="#d9534f",b.value="#d9534f",p.value="\u9A8C\u8BC1\u5931\u8D25",setTimeout(()=>{w()},700))})},400)}n.value<f.value&&(n.value=C(k(x,r)))},getMousePos:k,createPoint:C,refresh:w,getPictrue:T,pointTransfrom:N}}},U={style:{position:"relative"}},Z={class:"verify-img-out"},ee=[c("i",{class:"iconfont icon-refresh"},null,-1)],te=["src"],ae={class:"verify-msg"},ie=G(Q,[["render",function(B,u,v,e,o,f){return H(),$("div",U,[c("div",Z,[c("div",{class:"verify-img-panel",style:P({width:e.setSize.imgWidth,height:e.setSize.imgHeight,"background-size":e.setSize.imgWidth+" "+e.setSize.imgHeight,"margin-bottom":v.vSpace+"px"})},[F(c("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:u[0]||(u[0]=(...i)=>e.refresh&&e.refresh(...i))},ee,512),[[X,e.showRefresh]]),c("img",{src:"data:image/png;base64,"+e.pointBackImgBase,ref:"canvas",alt:"",style:{width:"100%",height:"100%",display:"block"},onClick:u[1]||(u[1]=i=>e.bindingClick?e.canvasClick(i):void 0)},null,8,te),(H(!0),$(Y,null,_(e.tempPoints,(i,t)=>(H(),$("div",{key:t,class:"point-area",style:P({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:parseInt(i.y-10)+"px",left:parseInt(i.x-10)+"px"})},A(t+1),5))),128))],4)]),c("div",{class:"verify-bar-area",style:P({width:e.setSize.imgWidth,color:this.barAreaColor,"border-color":this.barAreaBorderColor,"line-height":this.barSize.height})},[c("span",ae,A(e.text),1)],4)])}]]);export{ie as default};
