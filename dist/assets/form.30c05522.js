import{v as z,a as A,p as G,b as H,g as Q}from"./appuser.8d9d83c2.js";import{l as W}from"./approle.6eae0692.js";import{u as X}from"./dict.10eb31b5.js";import{d as Y,r as I,u as f}from"./index.0f5ebb0a.js";import{l as U,r as b,R as Z,aa as d,ah as ee,m as c,q as h,L as r,E as o,t as ae,I as V,J as _,u,F as le,D as v,K as T,$ as x,j as re,n as se}from"./vue.4dfaac09.js";const oe={class:"system-user-dialog-container"},ue={class:"dialog-footer"},te=U({name:"systemUserDialog"}),de=U({...te,emits:["refresh"],setup(pe,{expose:q,emit:F}){const{t:k}=Y(),$=F,{lock_flag:L}=X("lock_flag"),g=b(),n=b(!1),w=b([]),i=b(!1),l=Z({userId:"",username:"",password:"",salt:"",wxOpenid:"",qqOpenid:"",lockFlag:"0",phone:"",deptId:"",roleList:[],postList:[],nickname:"",name:"",email:"",post:[],role:[]}),N=b({username:[{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:3,max:20,message:"\u7528\u6237\u540D\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 3 \u548C 20 \u4E4B\u95F4",trigger:"blur"},{validator:(e,a,t)=>{z(e,a,t,l.userId!=="")},trigger:"blur"}],password:[{required:!0,message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:6,max:20,message:"\u7528\u6237\u5BC6\u7801\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 6 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],name:[{required:!0,message:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:I.chinese,trigger:"blur"}],role:[{required:!0,message:"\u89D2\u8272\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],phone:[{required:!0,message:"\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:I.validatePhone,trigger:"blur"},{validator:(e,a,t)=>{A(e,a,t,l.userId!=="")},trigger:"blur"}],email:[{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:["blur","change"]}],nickname:[{required:!0,message:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A",nickname:"blur"}]}),B=async()=>{if(!await g.value.validate().catch(()=>{}))return!1;try{const{userId:e,phone:a,password:t}=l;e?(a!=null&&a.includes("*")&&(l.phone=void 0),t!=null&&t.includes("******")&&(l.password=void 0),i.value=!0,await G(l),f().success(k("common.editSuccessText")),n.value=!1,$("refresh")):(i.value=!0,await H(l),f().success(k("common.addSuccessText")),n.value=!1,$("refresh"))}catch(e){f().error(e.msg)}finally{i.value=!1}},D=async e=>{i.value=!0;try{const{data:a}=await Q(e);Object.assign(l,a),l.password="******",a.roleList&&(l.role=a.roleList.map(t=>t.roleId))}finally{i.value=!1}},O=()=>{W().then(e=>{w.value=e.data})};return q({openDialog:e=>{n.value=!0,l.userId="",se(()=>{g.value.resetFields()}),e&&(l.userId=e,D(e)),O()}}),(e,a)=>{const t=d("el-input"),p=d("el-form-item"),m=d("el-col"),P=d("el-option"),R=d("el-select"),j=d("el-radio"),C=d("el-radio-group"),E=d("el-row"),S=d("el-form"),y=d("el-button"),J=d("el-dialog"),K=ee("loading");return c(),h("div",oe,[r(J,{modelValue:u(n),"onUpdate:modelValue":a[9]||(a[9]=s=>re(n)?n.value=s:null),"close-on-click-modal":!1,title:u(l).userId?e.$t("common.editBtn"):e.$t("common.addBtn"),draggable:""},{footer:o(()=>[ae("span",ue,[r(y,{onClick:a[8]||(a[8]=s=>n.value=!1)},{default:o(()=>[V(_(e.$t("common.cancelButtonText")),1)]),_:1}),r(y,{type:"primary",onClick:B,disabled:u(i)},{default:o(()=>[V(_(e.$t("common.confirmButtonText")),1)]),_:1},8,["disabled"])])]),default:o(()=>[le((c(),v(S,{ref_key:"dataFormRef",ref:g,model:u(l),rules:u(N),"label-width":"90px"},{default:o(()=>[r(E,{gutter:20},{default:o(()=>[r(m,{span:12,class:"mb20"},{default:o(()=>[r(p,{label:e.$t("appuser.username"),prop:"username"},{default:o(()=>[r(t,{modelValue:u(l).username,"onUpdate:modelValue":a[0]||(a[0]=s=>u(l).username=s),disabled:u(l).userId!=="",placeholder:e.$t("appuser.inputUserNameTip")},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])]),_:1}),r(m,{span:12,class:"mb20"},{default:o(()=>[r(p,{label:e.$t("appuser.password"),prop:"password"},{default:o(()=>[r(t,{modelValue:u(l).password,"onUpdate:modelValue":a[1]||(a[1]=s=>u(l).password=s),placeholder:e.$t("appuser.inputPasswordTip"),clearable:"",type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(m,{span:12,class:"mb20"},{default:o(()=>[r(p,{label:e.$t("appuser.name"),prop:"name"},{default:o(()=>[r(t,{modelValue:u(l).name,"onUpdate:modelValue":a[2]||(a[2]=s=>u(l).name=s),placeholder:e.$t("appuser.inputNameTip"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(m,{span:12,class:"mb20"},{default:o(()=>[r(p,{label:e.$t("appuser.phone"),prop:"phone"},{default:o(()=>[r(t,{modelValue:u(l).phone,"onUpdate:modelValue":a[3]||(a[3]=s=>u(l).phone=s),placeholder:e.$t("appuser.inputPhoneTip"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(m,{span:12,class:"mb20"},{default:o(()=>[r(p,{label:e.$t("appuser.role"),prop:"role"},{default:o(()=>[r(R,{modelValue:u(l).role,"onUpdate:modelValue":a[4]||(a[4]=s=>u(l).role=s),placeholder:e.$t("appuser.inputRoleTip"),clearable:"",multiple:""},{default:o(()=>[(c(!0),h(T,null,x(u(w),s=>(c(),v(P,{key:s.roleId,label:s.roleName,value:s.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(m,{span:12,class:"mb20"},{default:o(()=>[r(p,{label:e.$t("appuser.email"),prop:"email"},{default:o(()=>[r(t,{modelValue:u(l).email,"onUpdate:modelValue":a[5]||(a[5]=s=>u(l).email=s),placeholder:e.$t("appuser.inputEmailTip"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(m,{span:12,class:"mb20"},{default:o(()=>[r(p,{label:e.$t("appuser.nickname"),prop:"nickname"},{default:o(()=>[r(t,{modelValue:u(l).nickname,"onUpdate:modelValue":a[6]||(a[6]=s=>u(l).nickname=s),placeholder:e.$t("appuser.inputNickNameTip"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(m,{span:12,class:"mb20"},{default:o(()=>[r(p,{label:e.$t("appuser.lockFlag"),prop:"lockFlag"},{default:o(()=>[r(C,{modelValue:u(l).lockFlag,"onUpdate:modelValue":a[7]||(a[7]=s=>u(l).lockFlag=s)},{default:o(()=>[(c(!0),h(T,null,x(u(L),(s,M)=>(c(),v(j,{key:M,label:s.value,border:""},{default:o(()=>[V(_(s.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[K,u(i)]])]),_:1},8,["modelValue","title"])])}}});export{de as default};
