import{r as Z,a as _,b as ee,c as te}from"./index.f675f2a1.js";import{a7 as ae,g as ie,r as a,R as se,a as le,e as oe,h as ne,m as W,q as C,z as u,t as r,F as re,M as ue,L as ve,E as ce,y as P,J as N,H as R,T as de,n as he}from"./vue.4dfaac09.js";import{_ as fe,d as pe}from"./index.0f5ebb0a.js";const ge={name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"\u5411\u53F3\u6ED1\u52A8\u5B8C\u6210\u9A8C\u8BC1"},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(j){const{t:o}=pe(),{mode:n,captchaType:e,type:F,blockSize:w}=ae(j),{proxy:i}=ie();let v=a(""),I=a(""),X=a(""),q=a(""),f=a(""),T=a(""),L=a(""),G=a(""),c=a(""),S=a(""),A=a(""),d=se({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),Q=a(0),U=a(0),x=a(void 0),H=a(void 0),p=a(void 0),g=a("#ddd"),m=a(void 0),k=a("icon-right"),y=a(!1),h=a(!1),$=a(!0),E=a(""),M=a(""),O=a(0);const b=le(()=>i.$el.querySelector(".verify-bar-area"));function K(){S.value=o("verify.slide.explain"),V(),he(()=>{let{imgHeight:t,imgWidth:s,barHeight:l,barWidth:J}=Z(i);d.imgHeight=t,d.imgWidth=s,d.barHeight=l,d.barWidth=J,i.$parent.$emit("ready",i)}),window.removeEventListener("touchmove",function(t){B(t)}),window.removeEventListener("mousemove",function(t){B(t)}),window.removeEventListener("touchend",function(){z()}),window.removeEventListener("mouseup",function(){z()}),window.addEventListener("touchmove",function(t){B(t)}),window.addEventListener("mousemove",function(t){B(t)}),window.addEventListener("touchend",function(){z()}),window.addEventListener("mouseup",function(){z()})}function B(t){if(t=t||window.event,y.value&&h.value==0){let l=null;l=t.touches?t.touches[0].pageX:t.clientX;var s=l-b.value.getBoundingClientRect().left;s>=b.value.offsetWidth-parseInt(parseInt(w.value.width)/2)-2&&(s=b.value.offsetWidth-parseInt(parseInt(w.value.width)/2)-2),s<=0&&(s=parseInt(parseInt(w.value.width)/2)),x.value=s-O.value+"px",H.value=s-O.value+"px"}}function z(){if(L.value=+new Date,y.value&&h.value==0){var t=parseInt((x.value||"").replace("px",""));t=310*t/parseInt(d.imgWidth);let s={captchaType:e.value,pointJson:v.value?_(JSON.stringify({x:t,y:5}),v.value):JSON.stringify({x:t,y:5}),token:f.value};ee(s).then(l=>{if(l.data.repCode=="0000"){p.value="#5cb85c",g.value="#5cb85c",m.value="#fff",k.value="icon-check",$.value=!1,h.value=!0,n.value=="pop"&&setTimeout(()=>{i.$parent.clickShow=!1,D()},1500),I.value=!0;const Y=((L.value-T.value)/1e3).toFixed(2);c.value=o("verify.slide.time",{time:Y});var J=v.value?_(f.value+"---"+JSON.stringify({x:t,y:5}),v.value):f.value+"---"+JSON.stringify({x:t,y:5});setTimeout(()=>{c.value="",i.$parent.$parent.closeBox(),i.$parent.$parent.$emit("success",{captchaVerification:J})},1e3)}else p.value="#d9534f",g.value="#d9534f",m.value="#fff",k.value="icon-close",I.value=!1,setTimeout(function(){D()},1e3),i.$parent.$emit("error",i),c.value=o("verify.slide.fail"),setTimeout(()=>{c.value=""},1e3)}),y.value=!1}}oe(F,()=>{K()}),ne(()=>{K(),i.$el.onselectstart=function(){return!1}});const D=()=>{$.value=!0,A.value="",E.value="left .3s",x.value=0,H.value=void 0,M.value="width .3s",g.value="#ddd",p.value="#fff",m.value="#000",k.value="icon-right",h.value=!1,V(),setTimeout(()=>{M.value="",E.value="",S.value=o("verify.slide.explain")},300)};function V(){let t={captchaType:e.value};te(t).then(s=>{let l=s.data;l.repCode=="0000"?(X.value=l.repData.originalImageBase64,q.value=l.repData.jigsawImageBase64,f.value=l.repData.token,v.value=l.repData.secretKey):c.value=l.repMsg})}return{secretKey:v,passFlag:I,backImgBase:X,blockBackImgBase:q,backToken:f,startMoveTime:T,endMovetime:L,tipsBackColor:G,tipWords:c,text:S,finishText:A,setSize:d,top:Q,left:U,moveBlockLeft:x,leftBarWidth:H,moveBlockBackgroundColor:p,leftBarBorderColor:g,iconColor:m,iconClass:k,status:y,isEnd:h,showRefresh:$,transitionLeft:E,transitionWidth:M,barArea:b,refresh:D,start:function(t){let s=null;s=(t=t||window.event).touches?t.touches[0].pageX:t.clientX,O.value=Math.floor(s-b.value.getBoundingClientRect().left),T.value=+new Date,h.value==0&&(S.value="",p.value="#337ab7",g.value="#337AB7",m.value="#fff",t.stopPropagation(),y.value=!0)},t:o}}},me={style:{position:"relative"}},ye=["src"],be=[r("i",{class:"iconfont icon-refresh"},null,-1)],we=["textContent"],Se=["textContent"],xe=["src"],ke=fe(ge,[["render",function(j,o,n,e,F,w){return W(),C("div",me,[n.type==="2"?(W(),C("div",{key:0,style:u({height:parseInt(e.setSize.imgHeight)+n.vSpace+"px"}),class:"verify-img-out"},[r("div",{style:u({width:e.setSize.imgWidth,height:e.setSize.imgHeight}),class:"verify-img-panel modern-shadow"},[r("img",{src:"data:image/png;base64,"+e.backImgBase,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,ye),re(r("div",{class:"verify-refresh",onClick:o[0]||(o[0]=(...i)=>e.refresh&&e.refresh(...i))},be,512),[[ue,e.showRefresh]]),ve(de,{name:"tips"},{default:ce(()=>[e.tipWords?(W(),C("span",{key:0,class:P([e.passFlag?"suc-bg":"err-bg","verify-tips"])},N(e.tipWords),3)):R("",!0)]),_:1})],4)],4)):R("",!0),r("div",{style:u({width:e.setSize.imgWidth,height:n.barSize.height,"line-height":n.barSize.height}),class:"verify-bar-area modern-bar"},[r("span",{class:"verify-msg",textContent:N(e.text)},null,8,we),r("div",{style:u({width:e.leftBarWidth!==void 0?e.leftBarWidth:n.barSize.height,height:n.barSize.height,"border-color":e.leftBarBorderColor,transaction:e.transitionWidth}),class:"verify-left-bar"},[r("span",{class:"verify-msg",textContent:N(e.finishText)},null,8,Se),r("div",{style:u({width:n.barSize.height,height:n.barSize.height,"background-color":e.moveBlockBackgroundColor,left:e.moveBlockLeft,transition:e.transitionLeft}),class:"verify-move-block",onMousedown:o[1]||(o[1]=(...i)=>e.start&&e.start(...i)),onTouchstart:o[2]||(o[2]=(...i)=>e.start&&e.start(...i))},[r("i",{class:P(["verify-icon iconfont",e.iconClass]),style:u({color:e.iconColor})},null,6),n.type==="2"?(W(),C("div",{key:0,style:u({width:Math.floor(47*parseInt(e.setSize.imgWidth)/310)+"px",height:e.setSize.imgHeight,top:"-"+(parseInt(e.setSize.imgHeight)+n.vSpace)+"px","background-size":e.setSize.imgWidth+" "+e.setSize.imgHeight}),class:"verify-sub-block"},[r("img",{src:"data:image/png;base64,"+e.blockBackImgBase,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,xe)],4)):R("",!0)],36)],4)],4)])}]]);export{ke as default};
