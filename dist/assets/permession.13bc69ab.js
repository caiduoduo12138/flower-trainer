import{d as _,aj as j,o as V,u as k,ak as A}from"./index.0f5ebb0a.js";import{p as E}from"./index.97aa2129.js";import{l as y,r as n,R as N,aa as c,ah as P,m as $,q,L as d,E as i,t as u,J as v,u as o,I as D,F}from"./vue.4dfaac09.js";import"./loading.50b2b84c.js";const H={class:"system-role-dialog-container"},J={class:"flex items-center justify-between"},L={class:"flex mr-16"},M={class:"dialog-footer"},O=y({name:"role-permession"}),R=y({...O,setup(U,{expose:b}){const{t:g}=_(),s=n(),x=n(!0),r=n(!1),e=N({checkedKeys:[],treeData:[],defaultProps:{label:"name",value:"id"},roleId:"",dialog:{isShowDialog:!1,title:"\u5206\u914D\u6743\u9650",submitTxt:"\u66F4\u65B0"}}),h=n([]),w=l=>{const a=e.treeData;for(let t=0;t<a.length;t++)s.value.store.nodesMap[a[t].id].expanded=l},C=l=>{var a,t;l?(a=s.value)==null||a.setCheckedKeys(e.treeData.map(m=>m.id)):(t=s.value)==null||t.setCheckedKeys([])},I=()=>{if(e.roleId==="1"&&!s.value.getCheckedNodes().map(a=>a.name).includes("\u5206\u914D\u6743\u9650"))return void k().error(g("sysrole.mustCheckOneTip"));const l=s.value.getCheckedKeys().join(",").concat(",").concat(s.value.getHalfCheckedKeys().join(","));r.value=!0,A(e.roleId,l).then(()=>{e.dialog.isShowDialog=!1,k().success(g("common.editSuccessText"))}).finally(()=>{r.value=!1})};return b({openDialog:l=>{e.checkedKeys=[],e.treeData=[],h.value=[],e.roleId=l.roleId,r.value=!0,j(l.roleId).then(a=>(h.value=a.data,E())).then(a=>{e.treeData=a.data,e.checkedKeys=V.resolveAllEunuchNodeId(e.treeData,h.value,[])}).finally(()=>{r.value=!1}),e.dialog.isShowDialog=!0}}),(l,a)=>{const t=c("el-checkbox"),m=c("el-tree"),K=c("el-scrollbar"),p=c("el-button"),S=c("el-dialog"),T=P("loading");return $(),q("div",H,[d(S,{width:"30%",modelValue:o(e).dialog.isShowDialog,"onUpdate:modelValue":a[1]||(a[1]=f=>o(e).dialog.isShowDialog=f),"close-on-click-modal":!1,draggable:""},{header:i(()=>[u("div",J,[u("div",null,v(o(e).dialog.title),1),u("div",L,[d(t,{label:l.$t("common.expand"),onChange:w},null,8,["label"]),d(t,{label:l.$t("common.selectAll"),onChange:C},null,8,["label"])])])]),footer:i(()=>[u("span",M,[d(p,{onClick:a[0]||(a[0]=f=>o(e).dialog.isShowDialog=!1)},{default:i(()=>[D("\u53D6 \u6D88")]),_:1}),d(p,{type:"primary",onClick:I},{default:i(()=>[D(v(o(e).dialog.submitTxt),1)]),_:1})])]),default:i(()=>[d(K,{class:"h-[400px] sm:h-[600px]"},{default:i(()=>[F(d(m,{ref_key:"menuTree",ref:s,data:o(e).treeData,"default-checked-keys":o(e).checkedKeys,"check-strictly":!o(x),props:o(e).defaultProps,class:"filter-tree","node-key":"id","highlight-current":"","show-checkbox":""},null,8,["data","default-checked-keys","check-strictly","props"]),[[T,o(r)]])]),_:1})]),_:1},8,["modelValue"])])}}});export{R as default};
