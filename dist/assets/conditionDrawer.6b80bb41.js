import{$ as G}from"./index.28ce57ef.js";import{u as P}from"./index.26cedbc4.js";import Q from"./condition.7a8b7b0e.js";import{u as R}from"./flow.3bb50ae4.js";import{_ as W}from"./index.0f5ebb0a.js";import{r as b,a as C,e as X,g as Y,aa as L,m as f,D as _,E as p,t as k,y as Z,L as m,u as g,q as w,K as I,$ as j,J as H,H as M,I as $,j as ee}from"./vue.4dfaac09.js";const oe=["id"],te={class:"card-header"},ie={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},le={__name:"conditionDrawer",setup(ae){let s=b({conditionNodes:[]}),d=b({}),U=b(""),N=P(),{setCondition:q,setConditionsConfig:z}=N,D=C(()=>N.conditionsConfig1),E=C(()=>N.conditionDrawer),h=C({get:()=>E.value,set(){S()}});const J=()=>{var i;(i=d.value)==null||i.conditionList.push({mode:!0,conditionList:[{}]})};let K=R();const O=C(()=>K.step2),A=()=>{};X(D,i=>{var t,r,x,e;let l=i.value.conditionNodes;for(var c of l){let u=c.conditionList;for(var y of u){let v=y.conditionList;for(var n of v){let a=n.key;if(a==="root")n.keyType="SelectUser";else{let o=O.value.filter(V=>V.field===a);o.length>0&&((r=(t=o[0])==null?void 0:t.props)==null?void 0:r.type)==="user"?n.keyType="SelectUser":o.length>0&&((e=(x=o[0])==null?void 0:x.props)==null?void 0:e.type)==="dept"?n.keyType="SelectDept":o.length>0&&(n.keyType=o[0].type)}}}}s.value=i.value,U.value=i.priorityLevel,d.value=i.priorityLevel?s.value.conditionNodes[i.priorityLevel-1]:{nodeUserList:[],conditionList:[]}}),Y();const B=()=>{S();var i=s.value.conditionNodes.splice(U.value-1,1);s.value.conditionNodes.splice(d.value.priorityLevel-1,0,i[0]),s.value.conditionNodes.map((t,r)=>{t.priorityLevel=r+1});for(var l=0;l<s.value.conditionNodes.length;l++){let t=s.value.conditionNodes[l];t.error=!1;let r=t.conditionList;if(l!=s.value.conditionNodes.length-1){var c=r.length==0;for(var y of r)for(var n of(c=y.conditionList.length==0,y.conditionList))if(!n.key||!n.expression||!n.value){c=!0;break}t.error=c}t.placeHolder=G.conditionStr(s.value,l)}z({value:s.value,flag:!0,id:D.value.id})},S=i=>{q(!1)};return(i,l)=>{const c=L("el-switch"),y=L("el-form-item"),n=L("el-form"),t=L("el-button"),r=L("el-card"),x=L("el-drawer");return f(),_(x,{"append-to-body":!0,title:"\u6761\u4EF6\u8BBE\u7F6E",modelValue:g(h),"onUpdate:modelValue":l[1]||(l[1]=e=>ee(h)?h.value=e:h=e),"show-close":!1,size:550,onOpen:A,"before-close":B},{header:p(({titleId:e,titleClass:u})=>[k("h3",{id:e,class:Z(u)},"\u6761\u4EF6\u8BBE\u7F6E",10,oe)]),default:p(()=>[m(n,{"label-width":"120px"},{default:p(()=>[m(y,{label:"\u6761\u4EF6\u7EC4\u5173\u7CFB"},{default:p(()=>[m(c,{modelValue:g(d).groupMode,"onUpdate:modelValue":l[0]||(l[0]=e=>g(d).groupMode=e),"active-text":"\u4E14","inactive-text":"\u6216"},null,8,["modelValue"])]),_:1})]),_:1}),(f(!0),w(I,null,j(g(d).conditionList,(e,u)=>(f(),_(r,{class:"box-card",key:u,style:{"margin-bottom":"20px"}},{header:p(()=>[k("div",te,[k("span",null,"\u6761\u4EF6\u7EC4"+H(u+1),1),m(c,{modelValue:e.mode,"onUpdate:modelValue":v=>e.mode=v,"active-text":"\u4E14","inactive-text":"\u6216"},null,8,["modelValue","onUpdate:modelValue"]),g(d).conditionList.length>1?(f(),_(t,{key:0,text:"",onClick:v=>(a=>{var o;(o=d.value)==null||o.conditionList.splice(a,1)})(u),icon:"Delete"},null,8,["onClick"])):M("",!0)])]),default:p(()=>[(f(!0),w(I,null,j(e.conditionList,(v,a)=>(f(),w("div",{key:a},[k("div",ie,[k("div",null,H(a==0?"\u5F53":e.mode?"\u4E14":"\u6216"),1),k("div",null,[e.conditionList.length>1?(f(),_(t,{key:0,text:"",onClick:o=>((V,F)=>{var T;(T=d.value)==null||T.conditionList[V].conditionList.splice(F,1)})(u,a),icon:"Delete"},null,8,["onClick"])):M("",!0)])]),m(Q,{condition:v},null,8,["condition"])]))),128)),m(t,{dark:"",type:"success",style:{"margin-top":"20px"},onClick:v=>(a=>{let o=a.conditionList;o||(o=[]),o.push({}),a.conditionList=o})(e)},{default:p(()=>[$("\u6DFB\u52A0\u6761\u4EF6")]),_:2},1032,["onClick"])]),_:2},1024))),128)),m(t,{dark:"",type:"primary",onClick:J},{default:p(()=>[$("\u6DFB\u52A0\u6761\u4EF6\u7EC4")]),_:1})]),_:1},8,["modelValue"])}}},ne=W(le,[["__scopeId","data-v-053a90ef"]]);export{ne as default};
