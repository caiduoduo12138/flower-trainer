import{l as ea,w as ba,H as qa,o as sa,A as v,k as Ca,b as ka,S as L,Z as Ra,u as xa,aR as ia,_ as Da,__tla as Sa}from"./index.0f5ebb0a.js";import{l as ra,r as S,ap as la,aq as Ta,as as Aa,R as Ia,a as E,Z as Pa,N as _a,ab as Ua,h as $a,az as Oa,e as Ea,aa as na,m as V,q as C,L as j,E as ja,t as ua,y as H,u as g,K as oa,$ as Ha,P as k,H as R,D as M,J as Ma,av as Wa,n as W}from"./vue.4dfaac09.js";import{S as za}from"./sortable.esm.71d81605.js";let ma,Fa=Promise.all([(()=>{try{return Sa}catch{}})()]).then(async()=>{let z,F,K;z=["data-url","onContextmenu","onMousedown","onClick"],F={key:0,class:"iconfont icon-webicon318 layout-navbars-tagsview-ul-li-iconfont"},K=ra({name:"layoutTagsView"}),ma=Da(ra({...K,setup(Ka){const ca=Wa(()=>ka(()=>import("./contextmenu.4192082e.js"),["assets/contextmenu.4192082e.js","assets/vue.4dfaac09.js","assets/index.0f5ebb0a.js","assets/index.3d43c53c.css","assets/contextmenu.c1cfb65f.css"])),p=S([]),x=S(),N=S(),ha=S(),wa=ea(),pa=ba(),Z=ea(),{themeConfig:J}=la(pa),{tagsViewRoutes:ga,favoriteRoutes:fa}=la(Z),d=qa(),w=Ta(),c=Aa(),s=Ia({routeActive:"",routePath:w.path,dropdown:{x:"",y:""},sortable:"",tagsRefsIndex:0,tagsViewList:[],tagsViewRoutesList:[]}),ya=E(()=>J.value.tagsStyle),m=E(()=>J.value),da=E(()=>t=>sa.setTagsViewNameI18n(t)),D=t=>m.value.isShareTagsView?t.path===s.routePath:(t.query&&Object.keys(t.query).length||t.params&&Object.keys(t.params).length)&&t.url?t.url===s.routeActive:t.path===s.routeActive,f=t=>{L.set("tagsViewList",t)},X=async()=>{s.routeActive=await y(w),s.routePath=await w.meta.isDynamic?w.meta.isDynamicPath:w.path,s.tagsViewList=[],s.tagsViewRoutesList=ga.value,Va()},Va=async()=>{L.get("tagsViewList")&&m.value.isCacheTagsView?s.tagsViewList=await L.get("tagsViewList"):(await s.tagsViewRoutesList.map(t=>{var a;(a=t.meta)!=null&&a.isAffix&&!t.meta.isHide&&(t.url=y(t),s.tagsViewList.push({...t}),d.addCachedView(t))}),await T(w.path,w)),aa(m.value.isShareTagsView?s.routePath:s.routeActive)},Y=async(t,a)=>{var r,i;let e=(r=a==null?void 0:a.meta)!=null&&r.isDynamic?a.meta.isDynamicPath:t;if(s.tagsViewList.filter(u=>{var n,l;return u.path===e&&ia((n=a==null?void 0:a.meta)!=null&&n.isDynamic?u.params?u.params:null:u.query?u.query:null,(l=a==null?void 0:a.meta)!=null&&l.isDynamic?a!=null&&a.params?a==null?void 0:a.params:null:a!=null&&a.query?a==null?void 0:a.query:null)}).length<=0){let u=s.tagsViewRoutesList.find(n=>n.path===e);if(!u||u.meta.isAffix||u.meta.isLink&&!u.meta.isIframe)return!1;(i=a==null?void 0:a.meta)!=null&&i.isDynamic?u.params=a.params:u.query=a==null?void 0:a.query,u.url=y(u),s.tagsViewList.push({...u}),await d.addCachedView(u),f(s.tagsViewList)}},B=(t,a)=>{var r;let e=(r=a==null?void 0:a.meta)!=null&&r.isDynamic?a.meta.isDynamicPath:t;s.tagsViewList.forEach(i=>{var u,n,l;i.path!==e||ia((u=a==null?void 0:a.meta)!=null&&u.isDynamic?i.params?i.params:null:i.query?i.query:null,(n=a==null?void 0:a.meta)!=null&&n.isDynamic?a!=null&&a.params?a==null?void 0:a.params:null:a!=null&&a.query?a==null?void 0:a.query:null)||((l=a==null?void 0:a.meta)!=null&&l.isDynamic?i.params=a.params:i.query=a==null?void 0:a.query,i.url=y(i),f(s.tagsViewList))})},T=(t,a)=>{W(async()=>{var r,i,u;let e;if((r=a==null?void 0:a.meta)!=null&&r.isDynamic){if(m.value.isShareTagsView?await B(t,a):await Y(t,a),s.tagsViewList.some(n=>{var l;return n.path===((l=a==null?void 0:a.meta)==null?void 0:l.isDynamicPath)}))return f(s.tagsViewList),!1;e=s.tagsViewRoutesList.find(n=>{var l;return n.path===((l=a==null?void 0:a.meta)==null?void 0:l.isDynamicPath)})}else{if(m.value.isShareTagsView?await B(t,a):await Y(t,a),s.tagsViewList.some(n=>n.path===t))return f(s.tagsViewList),!1;e=s.tagsViewRoutesList.find(n=>n.path===t)}return!!e&&!((i=e==null?void 0:e.meta)!=null&&i.isLink&&!e.meta.isIframe)&&((u=a==null?void 0:a.meta)!=null&&u.isDynamic?e.params=a!=null&&a.params?a==null?void 0:a.params:w.params:e.query=a!=null&&a.query?a==null?void 0:a.query:w.query,e.url=y(e),await d.addCachedView(e),await s.tagsViewList.push({...e}),void await f(s.tagsViewList))})},G=async t=>{var r;const a=decodeURI(t);let e={};if(s.tagsViewList.forEach(i=>{i.transUrl=q(i),i.transUrl?i.transUrl===q(i)&&(e=i):i.path===a&&(e=i)}),!e)return!1;await d.delCachedView(e),v.emit("onTagsViewRefreshRouterView",t),(r=e.meta)!=null&&r.isKeepAlive&&d.addCachedView(e)},A=t=>{s.tagsViewList.map((a,e,r)=>{var i;(i=a.meta)!=null&&i.isAffix||(m.value.isShareTagsView?a.path===t:a.url===t)&&(d.delCachedView(a),s.tagsViewList.splice(e,1),setTimeout(()=>{(s.tagsViewList.length===e&&m.value.isShareTagsView?s.routePath===t:s.routeActive===t)?r[r.length-1].meta.isDynamic?e!==r.length?c.push({name:r[e].name,params:r[e].params}):c.push({name:r[r.length-1].name,params:r[r.length-1].params}):e!==r.length?c.push({path:r[e].path,query:r[e].query}):c.push({path:r[r.length-1].path,query:r[r.length-1].query}):(s.tagsViewList.length!==e&&m.value.isShareTagsView?s.routePath===t:s.routeActive===t)&&(r[e].meta.isDynamic?c.push({name:r[e].name,params:r[e].params}):c.push({path:r[e].path,query:r[e].query}))},0))}),f(s.tagsViewList)},Q=t=>{let a={};return s.tagsViewList.forEach(e=>{e.transUrl=q(e),e.transUrl?e.transUrl===q(e)&&e.transUrl===t.commonUrl&&(a=e):e.path===decodeURI(t.path)&&(a=e)}),a||null},I=async t=>{if(t.commonUrl=q(t),!Q(t))return Ra({type:"warning",message:"\u8BF7\u6B63\u786E\u8F93\u5165\u8DEF\u5F84\u53CA\u5B8C\u6574\u53C2\u6570\uFF08query\u3001params\uFF09"});const{path:a,name:e,params:r,query:i,meta:u,url:n}=Q(t);switch(t.contextMenuClickId){case 0:u.isDynamic?await c.push({name:e,params:r}):await c.push({path:a,query:i}),G(w.fullPath);break;case 1:A(m.value.isShareTagsView?a:n);break;case 2:u.isDynamic?await c.push({name:e,params:r}):await c.push({path:a,query:i}),(l=>{L.get("tagsViewList")&&(s.tagsViewList=[],L.get("tagsViewList").map(o=>{var h;(h=o.meta)!=null&&h.isAffix&&!o.meta.isHide&&(o.url=y(o),d.delOthersCachedViews(o),s.tagsViewList.push({...o}))}),T(l,w),f(s.tagsViewList))})(a);break;case 3:L.get("tagsViewList")&&(d.delAllCachedViews(),s.tagsViewList=[],L.get("tagsViewList").map(l=>{var o;(o=l.meta)!=null&&o.isAffix&&!l.meta.isHide&&(l.url=y(l),s.tagsViewList.push({...l}),c.push({path:s.tagsViewList[s.tagsViewList.length-1].path}))}),f(s.tagsViewList));break;case 4:(async l=>{const o=s.tagsViewList.find(h=>m.value.isShareTagsView?h.path===l:h.url===l);o.meta.isDynamic?await c.push({name:o.name,params:o.params}):await c.push({name:o.name,query:o.query}),wa.setCurrenFullscreen(!0)})(m.value.isShareTagsView?a:n);break;case 5:va(t)}},va=t=>{fa.value.find(a=>a.path===t.path)?xa().error("\u5DF2\u7ECF\u5B58\u5728\u6536\u85CF"):Z.setFavoriteRoutes(t)},q=t=>{var r,i;let a=t.query&&Object.keys(t.query).length>0?t.query:t.params;if(!a)return"";let e="";for(let[u,n]of Object.entries(a))(r=t.meta)!=null&&r.isDynamic?e+=`/${n}`:e+=`&${u}=${n}`;return(i=t.meta)!=null&&i.isDynamic?t.isFnClick?decodeURI(t.path):`${t.path.split(":")[0]}${e.replace(/^\//,"")}`:`${t.path}${e.replace(/^&/,"?")}`},y=t=>{var r;let a=t.query&&Object.keys(t.query).length>0?t.query:t.params;if(!a||Object.keys(a).length<=0)return t.path;let e="";for(let i in a)e+=a[i];return`${(r=t.meta)!=null&&r.isDynamic?t.meta.isDynamicPath:t.path}-${e}`},La=t=>{x.value.$refs.wrapRef.scrollLeft+=t.wheelDelta/4},aa=t=>{W(async()=>{let a=await s.tagsViewList;s.tagsRefsIndex=a.findIndex(e=>m.value.isShareTagsView?e.path===t:e.url===t),W(()=>{if(p.value.length<=0)return!1;let e=p.value[s.tagsRefsIndex],r=s.tagsRefsIndex,i=p.value.length,u=p.value[0],n=p.value[p.value.length-1],l=x.value.$refs.wrapRef,o=l.scrollWidth,h=l.offsetWidth,b=l.scrollLeft,U=p.value[s.tagsRefsIndex-1],ta=p.value[s.tagsRefsIndex+1],$=0,O=0;e===u?l.scrollLeft=0:e===n?l.scrollLeft=o-h:($=r===0?u.offsetLeft-5:(U==null?void 0:U.offsetLeft)-5,O=r===i?n.offsetLeft+n.offsetWidth+5:ta.offsetLeft+ta.offsetWidth+5,O>b+h?l.scrollLeft=O-h:$<b&&(l.scrollLeft=$)),x.value.update()})})},P=async()=>{const t=document.querySelector(".layout-navbars-tagsview-ul");if(!t)return!1;s.sortable.el&&s.sortable.destroy(),s.sortable=za.create(t,{animation:300,dataIdAttr:"data-url",disabled:!m.value.isSortableTagsView,onEnd:()=>{const a=[];s.sortable.toArray().map(e=>{s.tagsViewList.map(r=>{r.url===e&&a.push({...r})})}),f(a)}})},_=async()=>{await P(),sa.isMobile()&&s.sortable.el&&s.sortable.destroy()};return Pa(()=>{_(),window.addEventListener("resize",_),v.on("onCurrentContextmenuClick",t=>{t.isFnClick=!0,I(t)}),v.on("openOrCloseSortable",()=>{P()}),v.on("openShareTagsView",()=>{m.value.isShareTagsView&&(c.push("/home/index"),s.tagsViewList=[],s.tagsViewRoutesList.map(t=>{var a;(a=t.meta)!=null&&a.isAffix&&!t.meta.isHide&&(t.url=y(t),s.tagsViewList.push({...t}))}))})}),_a(()=>{v.off("onCurrentContextmenuClick",()=>{}),v.off("openOrCloseSortable",()=>{}),v.off("openShareTagsView",()=>{}),window.removeEventListener("resize",_)}),Ua(()=>{p.value=[]}),$a(()=>{X(),P()}),Oa(async t=>{s.routeActive=y(t),s.routePath=t.meta.isDynamic?t.meta.isDynamicPath:t.path,await T(t.path,t),aa(m.value.isShareTagsView?s.routePath:s.routeActive)}),Ea(Ca.state,t=>{if(t.tagsViewRoutes.tagsViewRoutes.length===s.tagsViewRoutesList.length)return!1;X()},{deep:!0}),(t,a)=>{const e=na("SvgIcon"),r=na("el-scrollbar");return V(),C("div",{class:H(["layout-navbars-tagsview",{"layout-navbars-tagsview-shadow":g(m).layout==="classic"}])},[j(r,{ref_key:"scrollbarRef",ref:x,onWheel:k(La,["prevent"])},{default:ja(()=>[ua("ul",{class:H(["layout-navbars-tagsview-ul",g(ya)]),ref_key:"tagsUlRef",ref:ha},[(V(!0),C(oa,null,Ha(g(s).tagsViewList,(i,u)=>(V(),C("li",{key:u,class:H(["layout-navbars-tagsview-ul-li",{"is-active":D(i)}]),"data-url":i.url,onContextmenu:k(n=>((l,o)=>{const{clientX:h,clientY:b}=o;s.dropdown.x=h,s.dropdown.y=b,N.value.openContextmenu(l)})(i,n),["prevent"]),onMousedown:n=>((l,o)=>{var h;if(!((h=l.meta)!=null&&h.isAffix)&&o.button===1){const b=Object.assign({},{contextMenuClickId:1,...l});I(b)}})(i,n),onClick:n=>((l,o)=>{s.tagsRefsIndex=o,c.push(l)})(i,u),ref_for:!0,ref:n=>{n&&(g(p)[u]=n)}},[D(i)?(V(),C("i",F)):R("",!0),!D(i)&&g(m).isTagsviewIcon?(V(),M(e,{key:1,name:i.meta.icon,class:"pr5"},null,8,["name"])):R("",!0),ua("span",null,Ma(g(da)(i)),1),D(i)?(V(),C(oa,{key:2},[j(e,{name:"ele-RefreshRight",class:"ml5 layout-navbars-tagsview-ul-li-refresh",onClick:a[0]||(a[0]=k(n=>G(t.$route.fullPath),["stop"]))}),i.meta.isAffix?R("",!0):(V(),M(e,{key:0,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-active",onClick:k(n=>A(g(m).isShareTagsView?i.path:i.url),["stop"])},null,8,["onClick"]))],64)):R("",!0),i.meta.isAffix?R("",!0):(V(),M(e,{key:3,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-three",onClick:k(n=>A(g(m).isShareTagsView?i.path:i.url),["stop"])},null,8,["onClick"]))],42,z))),128))],2)]),_:1},512),j(g(ca),{dropdown:g(s).dropdown,ref_key:"contextmenuRef",ref:N,onCurrentContextmenuClick:I},null,8,["dropdown"])],2)}}}),[["__scopeId","data-v-a43545fc"]])});export{Fa as __tla,ma as default};
