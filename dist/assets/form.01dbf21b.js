import{v as Y,a as Z,c as ee,d as ae,g as le}from"./user.ab59c899.js";import{d as se,r as g,u as f,aa as re,an as oe}from"./index.0f5ebb0a.js";import{l as te}from"./post.2e109efd.js";import{u as de}from"./dict.10eb31b5.js";import{l as T,r as b,R as ue,aa as u,ah as me,m as p,q as h,L as s,E as t,t as ne,I as _,J as y,u as o,F as pe,D as v,K as I,$ as k,j as ie,n as ce}from"./vue.4dfaac09.js";const be={class:"system-user-dialog-container"},ge={class:"dialog-footer"},fe=T({name:"systemUserDialog"}),he=T({...fe,props:{deptId:{type:String,default:""}},emits:["refresh"],setup(D,{expose:O,emit:S}){const{t:w}=se(),$=S,{lock_flag:j}=de("lock_flag"),V=b(),i=b(!1),U=b([]),q=b([]),x=b([]),c=b(!1),C=D,a=ue({userId:"",username:"",password:"",salt:"",wxOpenid:"",qqOpenid:"",lockFlag:"0",phone:"",deptId:"",roleList:[],postList:[],nickname:"",name:"",email:"",post:[],role:[]}),N=b({username:[{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:5,max:20,message:"\u7528\u6237\u540D\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 5 \u548C 20 \u4E4B\u95F4",trigger:"blur"},{validator:(l,e,d)=>{Y(l,e,d,a.userId!=="")},trigger:"blur"}],password:[{required:!0,message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:6,max:20,message:"\u7528\u6237\u5BC6\u7801\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 5 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],name:[{validator:g.overLength,trigger:"blur"},{required:!0,message:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:g.chinese,trigger:"blur"}],deptId:[{required:!0,message:"\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],role:[{required:!0,message:"\u89D2\u8272\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],post:[{required:!0,message:"\u5C97\u4F4D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],phone:[{required:!0,message:"\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:g.validatePhone,trigger:"blur"},{validator:(l,e,d)=>{Z(l,e,d,a.userId!=="")},trigger:"blur"}],email:[{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:["blur","change"]},{validator:g.overLength,trigger:"blur"}],lockFlag:[{required:!0,message:"\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),R=async()=>{if(!await V.value.validate().catch(()=>{}))return!1;try{const{userId:l,phone:e,password:d}=a;l?(e!=null&&e.includes("*")&&(a.phone=void 0),d!=null&&d.includes("******")&&(a.password=void 0),c.value=!0,await ee(a),f().success(w("common.editSuccessText")),i.value=!1,$("refresh")):(c.value=!0,await ae(a),f().success(w("common.addSuccessText")),i.value=!1,$("refresh"))}catch(l){f().error(l.msg)}finally{c.value=!1}},E=async l=>{try{c.value=!0;const{data:e}=await le(l);Object.assign(a,e),e.roleList&&(a.role=e.roleList.map(d=>d.roleId)),e.postList&&(a.post=e.postList.map(d=>d.postId))}catch(e){f().error(e.msg)}finally{c.value=!1}},J=()=>{re().then(l=>{U.value=l.data,a.userId||(a.deptId=C.deptId)})},K=()=>{te().then(l=>{x.value=l.data,a.userId||(a.post=[l.data[0].postId])})},P=()=>{oe().then(l=>{q.value=l.data,a.userId||(a.role=[l.data[0].roleId])})};return O({openDialog:async l=>{i.value=!0,a.userId="",ce(()=>{var e;(e=V.value)==null||e.resetFields()}),l&&(a.userId=l,await E(l),a.password="******"),J(),K(),P()}}),(l,e)=>{const d=u("el-input"),m=u("el-form-item"),n=u("el-col"),F=u("el-option"),L=u("el-select"),z=u("el-tree-select"),A=u("el-radio"),G=u("el-radio-group"),H=u("el-row"),M=u("el-form"),B=u("el-button"),Q=u("el-dialog"),W=me("loading");return p(),h("div",be,[s(Q,{"close-on-click-modal":!1,title:o(a).userId?l.$t("common.editBtn"):l.$t("common.addBtn"),draggable:"",modelValue:o(i),"onUpdate:modelValue":e[11]||(e[11]=r=>ie(i)?i.value=r:null)},{footer:t(()=>[ne("span",ge,[s(B,{onClick:e[10]||(e[10]=r=>i.value=!1)},{default:t(()=>[_(y(l.$t("common.cancelButtonText")),1)]),_:1}),s(B,{onClick:R,type:"primary",disabled:o(c)},{default:t(()=>[_(y(l.$t("common.confirmButtonText")),1)]),_:1},8,["disabled"])])]),default:t(()=>[pe((p(),v(M,{model:o(a),rules:o(N),"label-width":"90px",ref_key:"dataFormRef",ref:V},{default:t(()=>[s(H,{gutter:20},{default:t(()=>[s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.username"),prop:"username"},{default:t(()=>[s(d,{disabled:o(a).userId!=="",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",modelValue:o(a).username,"onUpdate:modelValue":e[0]||(e[0]=r=>o(a).username=r)},null,8,["disabled","modelValue"])]),_:1},8,["label"])]),_:1}),s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.password"),prop:"password"},{default:t(()=>[s(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password",modelValue:o(a).password,"onUpdate:modelValue":e[1]||(e[1]=r=>o(a).password=r)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.name"),prop:"name"},{default:t(()=>[s(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",modelValue:o(a).name,"onUpdate:modelValue":e[2]||(e[2]=r=>o(a).name=r)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.phone"),prop:"phone"},{default:t(()=>[s(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",modelValue:o(a).phone,"onUpdate:modelValue":e[3]||(e[3]=r=>o(a).phone=r)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.role"),prop:"role"},{default:t(()=>[s(L,{clearable:"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272",modelValue:o(a).role,"onUpdate:modelValue":e[4]||(e[4]=r=>o(a).role=r)},{default:t(()=>[(p(!0),h(I,null,k(o(q),r=>(p(),v(F,{key:r.roleId,label:r.roleName,value:r.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.post"),prop:"post"},{default:t(()=>[s(L,{clearable:"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5C97\u4F4D",modelValue:o(a).post,"onUpdate:modelValue":e[5]||(e[5]=r=>o(a).post=r)},{default:t(()=>[(p(!0),h(I,null,k(o(x),r=>(p(),v(F,{key:r.postId,label:r.postName,value:r.postId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.dept"),prop:"deptId"},{default:t(()=>[s(z,{data:o(U),props:{value:"id",label:"name",children:"children"},"check-strictly":"",class:"w100",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u90E8\u95E8",modelValue:o(a).deptId,"onUpdate:modelValue":e[6]||(e[6]=r=>o(a).deptId=r)},null,8,["data","modelValue"])]),_:1},8,["label"])]),_:1}),s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.email"),prop:"email"},{default:t(()=>[s(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",modelValue:o(a).email,"onUpdate:modelValue":e[7]||(e[7]=r=>o(a).email=r)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.nickname"),prop:"nickname"},{default:t(()=>[s(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6635\u79F0",modelValue:o(a).nickname,"onUpdate:modelValue":e[8]||(e[8]=r=>o(a).nickname=r)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),s(n,{span:12,class:"mb20"},{default:t(()=>[s(m,{label:l.$t("sysuser.lockFlag"),prop:"lockFlag"},{default:t(()=>[s(G,{modelValue:o(a).lockFlag,"onUpdate:modelValue":e[9]||(e[9]=r=>o(a).lockFlag=r)},{default:t(()=>[(p(!0),h(I,null,k(o(j),(r,X)=>(p(),v(A,{key:X,label:r.value,border:""},{default:t(()=>[_(y(r.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[W,o(c)]])]),_:1},8,["title","modelValue"])])}}});export{he as default};
