import{g as W,a as y,e as U,r as q,h as fo,aa as go,ah as po,m as a,q as s,t,z as Co,u,J as N,K as k,F as I,ac as B,H as r,y as V,L as x,$ as z,D as A,at as uo,au as No}from"./vue.4dfaac09.js";import L from"./addNode.0fb2f482.js";import{p as vo,b as ho}from"./const.5d8c27a7.js";import{$ as b}from"./index.28ce57ef.js";import{_ as yo,d as ko,o as K}from"./index.0f5ebb0a.js";import{u as bo}from"./index.26cedbc4.js";import{u as Uo}from"./flow.3bb50ae4.js";const g=d=>(uo("data-v-1e8ec173"),d=d(),No(),d),mo={key:0,class:"node-wrap"},xo={key:0},Lo={class:"iconfont"},Po=["placeholder"],So={class:"text"},wo=g(()=>t("i",{class:"anticon anticon-right arrow"},null,-1)),Oo={key:0,class:"error_tip"},Jo=[g(()=>t("i",{class:"anticon anticon-exclamation-circle"},null,-1))],To={key:1,class:"branch-wrap"},_o={class:"branch-box-wrap"},Do={class:"branch-box"},Io={class:"condition-node"},Bo={class:"condition-node-box"},Vo=["onClick"],Ao={class:"title-wrapper"},Fo=["onBlur","onUpdate:modelValue"],Ho=["onClick"],$o={class:"priority-title"},jo=["onClick"],Wo=["onClick"],qo=["onClick"],zo={key:3,class:"content"},Ko={key:4,class:"error_tip"},Eo=[g(()=>t("i",{class:"anticon anticon-exclamation-circle"},null,-1))],Go=g(()=>t("div",{class:"top-left-cover-line"},null,-1)),Mo=g(()=>t("div",{class:"bottom-left-cover-line"},null,-1)),Qo=g(()=>t("div",{class:"top-right-cover-line"},null,-1)),Ro=g(()=>t("div",{class:"bottom-right-cover-line"},null,-1)),Xo={key:2,class:"branch-wrap"},Yo={class:"branch-box-wrap"},Zo={class:"branch-box"},oe={class:"condition-node"},ee={class:"condition-node-box"},ne=["onClick"],ie={class:"title-wrapper"},de=["onBlur","onUpdate:modelValue"],te=["onClick"],le=["onClick"],ae=["onClick"],ce={class:"content"},se={key:2,class:"error_tip"},re=[g(()=>t("i",{class:"anticon anticon-exclamation-circle"},null,-1))],fe=g(()=>t("div",{class:"top-left-cover-line"},null,-1)),ge=g(()=>t("div",{class:"bottom-left-cover-line"},null,-1)),pe=g(()=>t("div",{class:"top-right-cover-line"},null,-1)),Ce=g(()=>t("div",{class:"bottom-right-cover-line"},null,-1)),ue=yo({__name:"nodeWrap",props:{nodeConfig:{type:Object,default:()=>({})}},emits:["update:nodeConfig"],setup(d,{emit:E}){let h=W().uid,o=d,O=y(()=>vo[o.nodeConfig.type]);const{t:G}=ko();var J=y(()=>o.nodeConfig.type==0?b.arrToStr(o.nodeConfig.nodeUserList)||G("flow.allUser"):o.nodeConfig.type==1?b.setApproverStr(o.nodeConfig):o.nodeConfig.type==2?b.copyerStr(o.nodeConfig):"");U(J,(e,n,f)=>{o.nodeConfig.placeHolder=e});let M=Uo();const Q=y(()=>M.step2);U(()=>Q.value,e=>{let n=o.nodeConfig;if(n.type==1&&n.assignedType==8){let c=n.formUserId;e.filter(ro=>ro.field===c).length==0&&(n.formUserId="",n.formUserName="",n.error=!0)}if(n.type==4){var f=0,p=n.conditionNodes.length;for(var v of n.conditionNodes){if(f>=p-1)break;for(var i of v.conditionList)for(var l of i.conditionList)e.filter(c=>c.field===l.key).length==0&&(l.key="",l.expression="",l.keyType="",l.value="",v.error=!0);f++}}});let P=q([]),T=q(!1);const S=()=>{if(o.nodeConfig.type!=5)for(var e=0;e<o.nodeConfig.conditionNodes.length;e++){let v=o.nodeConfig.conditionNodes[e];v.error=!1;let i=v.conditionList;if(e!=o.nodeConfig.conditionNodes.length-1){var n=i.length==0;for(var f of i)for(var p of(n=f.conditionList.length==0,f.conditionList))if(!p.key||!p.expression||!p.value){n=!0;break}v.error=n}}};fo(()=>{o.nodeConfig.type==1?o.nodeConfig.error=!b.checkApproval(o.nodeConfig):o.nodeConfig.type==2?o.nodeConfig.error=!b.copyerStr(o.nodeConfig):o.nodeConfig.type==4&&S()});let C=E,m=bo(),{setPromoter:R,setApprover:X,setCopyer:Y,setCondition:Z,setStarterConfig:oo,setApproverConfig:eo,setCopyerConfig:no,setConditionsConfig:io}=m,to=y(()=>m.starterConfigData),lo=y(()=>m.approverConfigData),ao=y(()=>m.copyerConfig1),co=y(()=>m.conditionsConfig1);U(to,e=>{e.flag&&e.id===h&&C("update:nodeConfig",e.value)}),U(lo,e=>{e.flag&&e.id===h&&C("update:nodeConfig",e.value)}),U(ao,e=>{e.flag&&e.id===h&&C("update:nodeConfig",e.value)}),U(co,e=>{e.flag&&e.id===h&&C("update:nodeConfig",e.value)});const _=e=>{e||e===0?P.value[e]=!0:T.value=!0},D=e=>{e||e===0?(P.value[e]=!1,o.nodeConfig.conditionNodes[e].nodeName=o.nodeConfig.conditionNodes[e].nodeName||"\u6761\u4EF6"):(T.value=!1,o.nodeConfig.nodeName=o.nodeConfig.nodeName||O)};W();const so=()=>{C("update:nodeConfig",o.nodeConfig.childNode)},F=()=>{if(o.nodeConfig.type==5){let n=o.nodeConfig.conditionNodes.length+1;return o.nodeConfig.conditionNodes.push({nodeName:"\u5206\u652F"+n,type:3,id:K.getNonDuplicateID(),placeHolder:"\u6EE1\u8DB3\u6761\u4EF6",parentId:o.nodeConfig.id,priorityLevel:n,conditionList:[{conditionList:[]}],nodeUserList:[],childNode:null}),void C("update:nodeConfig",o.nodeConfig)}let e=o.nodeConfig.conditionNodes.length+1;o.nodeConfig.conditionNodes.push({nodeName:"\u6761\u4EF6"+e,type:3,parentId:o.nodeConfig.id,id:K.getNonDuplicateID(),priorityLevel:e,conditionList:[{mode:!0,conditionList:[{key:"",expression:""}]}],nodeUserList:[],childNode:null}),S(),C("update:nodeConfig",o.nodeConfig)},H=e=>{o.nodeConfig.conditionNodes.splice(e,1),o.nodeConfig.conditionNodes.map((n,f)=>{n.priorityLevel=f+1,n.nodeName=`\u6761\u4EF6${f+1}`}),S(),C("update:nodeConfig",o.nodeConfig),o.nodeConfig.conditionNodes.length==1&&(o.nodeConfig.childNode&&(o.nodeConfig.conditionNodes[0].childNode?$(o.nodeConfig.conditionNodes[0].childNode,o.nodeConfig.childNode):o.nodeConfig.conditionNodes[0].childNode=o.nodeConfig.childNode),C("update:nodeConfig",o.nodeConfig.conditionNodes[0].childNode))},$=(e,n)=>{e.childNode?$(e.childNode,n):e.childNode=n},j=e=>{var{type:n}=o.nodeConfig;n==0?(R(!0),oo({value:JSON.parse(JSON.stringify(o.nodeConfig)),flag:!1,id:h})):n==1?(X(!0),eo({value:{...JSON.parse(JSON.stringify(o.nodeConfig)),assignedType:o.nodeConfig.assignedType||1,multiple:o.nodeConfig.multiple||!1},flag:!1,id:h})):n==2?(Y(!0),no({value:JSON.parse(JSON.stringify(o.nodeConfig)),flag:!1,id:h})):(Z(!0),io({value:JSON.parse(JSON.stringify(o.nodeConfig)),priorityLevel:e,flag:!1,id:h}))},w=(e,n=1)=>{o.nodeConfig.conditionNodes[e]=o.nodeConfig.conditionNodes.splice(e+n,1,o.nodeConfig.conditionNodes[e])[0],o.nodeConfig.conditionNodes.map((f,p)=>{f.priorityLevel=p+1}),S(),C("update:nodeConfig",o.nodeConfig)};return(e,n)=>{var v;const f=go("nodeWrap",!0),p=po("focus");return a(),s("div",null,[d.nodeConfig.type<3?(a(),s("div",mo,[t("div",{class:V(["node-wrap-box",(d.nodeConfig.type==0?"start-node ":"")+(d.nodeConfig.error?"active error":"")])},[t("div",{class:"title",style:Co(`background: rgb(${u(ho)[d.nodeConfig.type]});`)},[d.nodeConfig.type==0?(a(),s("span",xo,N(d.nodeConfig.nodeName),1)):(a(),s(k,{key:1},[t("span",Lo,N(d.nodeConfig.type==1?"\uE8EF":"\uE93B"),1),u(T)?I((a(),s("input",{key:0,type:"text",class:"ant-input editable-title-input",onBlur:n[0]||(n[0]=i=>D()),onFocus:n[1]||(n[1]=i=>i.currentTarget.select()),"onUpdate:modelValue":n[2]||(n[2]=i=>d.nodeConfig.nodeName=i),placeholder:u(O)},null,40,Po)),[[p],[B,d.nodeConfig.nodeName]]):(a(),s("span",{key:1,class:"editable-title",onClick:n[3]||(n[3]=i=>_())},N(d.nodeConfig.nodeName),1)),t("i",{class:"anticon anticon-close close",onClick:so})],64))],4),t("div",{class:"content",onClick:j},[t("div",So,N(((v=u(J))==null?void 0:v.length)>0?u(J):"\u8BF7\u9009\u62E9"+u(O)),1),wo]),d.nodeConfig.error?(a(),s("div",Oo,Jo)):r("",!0)],2),x(L,{"current-node":d.nodeConfig,childNodeP:d.nodeConfig.childNode,"onUpdate:childNodeP":n[4]||(n[4]=i=>d.nodeConfig.childNode=i)},null,8,["current-node","childNodeP"])])):r("",!0),d.nodeConfig.type==4?(a(),s("div",To,[t("div",_o,[t("div",Do,[t("button",{class:"add-branch",onClick:F},"\u6DFB\u52A0\u6761\u4EF6"),(a(!0),s(k,null,z(d.nodeConfig.conditionNodes,(i,l)=>(a(),s("div",{class:"col-box",key:l},[t("div",Io,[t("div",Bo,[t("div",{class:V(["auto-judge",i.error?"error active":""])},[l!=0?(a(),s("div",{key:0,class:"sort-left",onClick:c=>w(l,-1)},"<",8,Vo)):r("",!0),t("div",Ao,[u(P)[l]?I((a(),s("input",{key:0,style:{width:"50%"},type:"text",class:"ant-input editable-title-input",onBlur:c=>D(l),onFocus:n[5]||(n[5]=c=>c.currentTarget.select()),"onUpdate:modelValue":c=>i.nodeName=c},null,40,Fo)),[[p],[B,i.nodeName]]):(a(),s("span",{key:1,class:"editable-title",onClick:c=>_(l)},N(i.nodeName),9,Ho)),t("span",$o,"\u4F18\u5148\u7EA7"+N(i.priorityLevel),1),t("i",{class:"anticon anticon-close close",onClick:c=>H(l)},null,8,jo)]),l!=d.nodeConfig.conditionNodes.length-1?(a(),s("div",{key:1,class:"sort-right",onClick:c=>w(l)},">",8,Wo)):r("",!0),l<d.nodeConfig.conditionNodes.length-1?(a(),s("div",{key:2,class:"content",onClick:c=>j(i.priorityLevel)},N(u(b).conditionStr(d.nodeConfig,l)),9,qo)):(a(),s("div",zo,N(u(b).conditionStr(d.nodeConfig,l)),1)),i.error?(a(),s("div",Ko,Eo)):r("",!0)],2),x(L,{childNodeP:i.childNode,"onUpdate:childNodeP":c=>i.childNode=c,"current-node":i},null,8,["childNodeP","onUpdate:childNodeP","current-node"])])]),i.childNode?(a(),A(f,{key:0,nodeConfig:i.childNode,"onUpdate:nodeConfig":c=>i.childNode=c},null,8,["nodeConfig","onUpdate:nodeConfig"])):r("",!0),l==0?(a(),s(k,{key:1},[Go,Mo],64)):r("",!0),l==d.nodeConfig.conditionNodes.length-1?(a(),s(k,{key:2},[Qo,Ro],64)):r("",!0)]))),128))]),x(L,{childNodeP:d.nodeConfig.childNode,"onUpdate:childNodeP":n[6]||(n[6]=i=>d.nodeConfig.childNode=i),"current-node":d.nodeConfig},null,8,["childNodeP","current-node"])])])):r("",!0),d.nodeConfig.type==5?(a(),s("div",Xo,[t("div",Yo,[t("div",Zo,[t("button",{class:"add-branch",onClick:F},"\u6DFB\u52A0\u5206\u652F"),(a(!0),s(k,null,z(d.nodeConfig.conditionNodes,(i,l)=>(a(),s("div",{class:"col-box",key:l},[t("div",oe,[t("div",ee,[t("div",{class:V(["auto-judge",i.error?"error active":""])},[l!=0?(a(),s("div",{key:0,class:"sort-left",onClick:c=>w(l,-1)},"<",8,ne)):r("",!0),t("div",ie,[u(P)[l]?I((a(),s("input",{key:0,style:{width:"50%"},type:"text",class:"ant-input editable-title-input",onBlur:c=>D(l),onFocus:n[7]||(n[7]=c=>c.currentTarget.select()),"onUpdate:modelValue":c=>i.nodeName=c},null,40,de)),[[p],[B,i.nodeName]]):(a(),s("span",{key:1,class:"editable-title",onClick:c=>_(l)},N(i.nodeName),9,te)),t("i",{class:"anticon anticon-close close",onClick:c=>H(l)},null,8,le)]),l!=d.nodeConfig.conditionNodes.length-1?(a(),s("div",{key:1,class:"sort-right",onClick:c=>w(l)},">",8,ae)):r("",!0),t("div",ce,N(i.placeHolder),1),i.error?(a(),s("div",se,re)):r("",!0)],2),x(L,{childNodeP:i.childNode,"onUpdate:childNodeP":c=>i.childNode=c,"current-node":i},null,8,["childNodeP","onUpdate:childNodeP","current-node"])])]),i.childNode?(a(),A(f,{key:0,nodeConfig:i.childNode,"onUpdate:nodeConfig":c=>i.childNode=c},null,8,["nodeConfig","onUpdate:nodeConfig"])):r("",!0),l==0?(a(),s(k,{key:1},[fe,ge],64)):r("",!0),l==d.nodeConfig.conditionNodes.length-1?(a(),s(k,{key:2},[pe,Ce],64)):r("",!0)]))),128))]),x(L,{childNodeP:d.nodeConfig.childNode,"onUpdate:childNodeP":n[8]||(n[8]=i=>d.nodeConfig.childNode=i),"current-node":d.nodeConfig},null,8,["childNodeP","current-node"])])])):r("",!0),d.nodeConfig.childNode?(a(),A(f,{key:3,nodeConfig:d.nodeConfig.childNode,"onUpdate:nodeConfig":n[9]||(n[9]=i=>d.nodeConfig.childNode=i)},null,8,["nodeConfig"])):r("",!0)])}}},[["__scopeId","data-v-1e8ec173"]]);export{ue as default};
