import{d as ee,r as O,y as le,v as $,u as F}from"./index.0f5ebb0a.js";import{a as ae,g as oe}from"./create-table.f7b672f0.js";import{u as te}from"./dict.10eb31b5.js";import{l as re}from"./fieldtype.651e3d76.js";import{f as ue}from"./table.a96d0687.js";import{l as L,r as f,R as me,aa as c,ah as ne,m as V,D as x,a1 as de,u as l,E as t,t as se,L as a,I as g,J as _,F as ce,q as k,K as I,$ as C,j as ie,n as pe}from"./vue.4dfaac09.js";const be={class:"dialog-footer"},fe=L({name:"CreateTableDialog"}),ye=L({...fe,emits:["refresh"],setup(he,{expose:P,emit:z}){const M=z,{t:m}=ee();te("yes_no_type");const q=[{value:-1,label:"\u5426"},{value:1,label:"\u662F"}],T=f(),y=f(!1),h=f(!1),N=f(),v=f(""),U=f([]),o=me({id:"",tableName:"",dsName:"",comments:"",databaseType:"",pkPolicy:"",primary:"",columnsInfo:"",columnInfo:"",columns:[]}),R=f({tableName:[{required:!0,message:"\u8868\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{max:32,message:"\u957F\u5EA6\u5728 32 \u4E2A\u5B57\u7B26",trigger:"blur"},{validator:O.validatorLowercase,trigger:"blur"},{validator:async(n,r,s)=>{const{data:i}=await ue({tableName:r});i.total===0?s():s(new Error("\u8868\u540D\u5DF2\u5B58\u5728"))},trigger:"blur"}],comments:[{validator:O.overLength,trigger:"blur"},{required:!0,message:"\u8868\u6CE8\u91CA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],databaseType:[{required:!0,message:"\u6570\u636E\u5E93\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],pkPolicy:[{required:!0,message:"\u4E3B\u952E\u7B56\u7565\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],columns:[{required:!0,message:"\u5B57\u6BB5\u4FE1\u606F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),j=async()=>{if(!await T.value.validate().catch(()=>{}))return!1;try{o.id&&await le().confirm("\u6CE8\u610F\uFF1A\u76EE\u524D\u4FEE\u6539\u4F1A\u91CD\u65B0\u5EFA\u8868"+o.tableName)}catch{return}try{h.value=!0,o.columnInfo=JSON.stringify(o.columns);let n={};o.columns.forEach(r=>{$(r.defaultValue)&&(r.defaultValue=null),n[r.name]=r}),o.columnsInfo=JSON.stringify(n),await ae(o),F().success(m(o.id?"common.editSuccessText":"common.addSuccessText")),y.value=!1,M("refresh")}catch(n){F().error(n.msg)}finally{h.value=!1}},K=n=>{h.value=!0,oe(n).then(r=>{let s=r.data.columnInfo;r.data.columns=$(s)?[]:JSON.parse(s),Object.assign(o,r.data)}).finally(()=>{h.value=!1})};let B=1;const S=()=>{if(o.columns.find(n=>n.name==="id")){let n={name:"",comment:"",typeName:"varchar",precision:255,scale:0,defaultValue:null,primary:-1,nullable:1};return void o.columns.splice(B++,0,n)}o.columns.push({name:"id",comment:"\u4E3B\u952E",typeName:"bigint",precision:20,scale:0,defaultValue:null,primary:1,nullable:-1}),o.columns.push({name:"create_by",comment:"\u521B\u5EFA\u4EBA",typeName:"varchar",precision:64,scale:0,defaultValue:null,primary:-1,nullable:1}),o.columns.push({name:"create_time",comment:"\u521B\u5EFA\u65F6\u95F4",typeName:"datetime",precision:0,scale:0,defaultValue:null,primary:-1,nullable:1}),o.columns.push({name:"update_by",comment:"\u4FEE\u6539\u4EBA",typeName:"varchar",precision:64,scale:0,defaultValue:null,primary:-1,nullable:1}),o.columns.push({name:"update_time",comment:"\u4FEE\u6539\u65F6\u95F4",typeName:"datetime",precision:0,scale:0,defaultValue:null,primary:-1,nullable:1}),o.columns.push({name:"del_flag",comment:"\u5220\u9664\u6807\u8BB0",typeName:"char",precision:1,scale:0,defaultValue:"0",primary:-1,nullable:-1}),o.columns.push({name:"tenant_id",comment:"\u79DF\u6237ID",typeName:"bigint",precision:0,scale:0,primary:-1,nullable:-1})},A=async()=>{U.value=[];const{data:n}=await re(),r=new Map;n.forEach(s=>{const{attrType:i,columnType:b}=s;r.has(i)||(r.set(b,i),U.value.push({label:b,value:b}))})};return P({openDialog:(n,r,s)=>{y.value=!0,N.value=n,o.id="",o.dsName=s,B=1,n==="add"?v.value=m("common.addBtn"):n==="edit"?v.value=m("common.editBtn"):n==="view"&&(v.value=m("common.viewBtn")),A(),pe(()=>{var i;(i=T.value)==null||i.resetFields(),r||S()}),r&&(o.id=r,K(r))}}),(n,r)=>{const s=c("el-input"),i=c("el-form-item"),b=c("el-col"),w=c("el-button"),p=c("el-table-column"),G=c("el-option"),H=c("el-select"),D=c("el-input-number"),E=c("el-radio"),J=c("el-radio-group"),Q=c("el-table"),W=c("el-row"),X=c("el-form"),Y=c("el-dialog"),Z=ne("loading");return V(),x(Y,{title:l(v),modelValue:l(y),"onUpdate:modelValue":r[3]||(r[3]=e=>ie(y)?y.value=e:null),width:"90%","close-on-click-modal":!1,draggable:""},de({default:t(()=>[ce((V(),x(X,{ref_key:"dataFormRef",ref:T,model:l(o),rules:l(R),"label-width":"150px",disabled:l(N)==="view"},{default:t(()=>[a(W,{gutter:24},{default:t(()=>[a(b,{span:12,class:"mb20"},{default:t(()=>[a(i,{label:l(m)("createTable.tableName"),prop:"tableName"},{default:t(()=>[a(s,{modelValue:l(o).tableName,"onUpdate:modelValue":r[0]||(r[0]=e=>l(o).tableName=e),placeholder:l(m)("createTable.inputTableNameTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(b,{span:12,class:"mb20"},{default:t(()=>[a(i,{label:l(m)("createTable.comments"),prop:"comments"},{default:t(()=>[a(s,{modelValue:l(o).comments,"onUpdate:modelValue":r[1]||(r[1]=e=>l(o).comments=e),placeholder:l(m)("createTable.inputCommentsTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(b,{span:24,class:"mb20"},{default:t(()=>[a(i,{label:l(m)("createTable.columnInfo"),prop:"columns"},{default:t(()=>[a(Q,{data:l(o).columns,border:"",style:{width:"100%"},"max-height":"500"},{default:t(()=>[a(p,{type:"index",label:l(m)("createTable.index"),width:"80"},{header:t(()=>[a(w,{icon:"Plus",size:"small",type:"primary",circle:"",onClick:S})]),default:t(e=>[a(w,{icon:"Minus",size:"small",type:"danger",circle:"",onClick:u=>{return d=e.$index,e.row,void o.columns.splice(d,1);var d}},null,8,["onClick"])]),_:1},8,["label"]),a(p,{prop:"name",label:l(m)("createTable.name"),"show-overflow-tooltip":""},{default:t(e=>[a(s,{modelValue:e.row.name,"onUpdate:modelValue":u=>e.row.name=u,placeholder:l(m)("createTable.name"),onBlur:u=>{var d;(d=e.row).name.includes("time")||d.name.includes("date")?(d.typeName="datetime",d.precision=0):d.name.includes("id")?(d.typeName="bigint",d.precision=20):d.name.includes("flag")||d.name.includes("status")?(d.typeName="char",d.precision=1):(d.typeName="varchar",d.precision=255)}},null,8,["modelValue","onUpdate:modelValue","placeholder","onBlur"])]),_:1},8,["label"]),a(p,{prop:"comment",label:l(m)("createTable.comment"),"show-overflow-tooltip":""},{default:t(e=>[a(s,{modelValue:e.row.comment,"onUpdate:modelValue":u=>e.row.comment=u,placeholder:l(m)("createTable.comment")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["label"]),a(p,{prop:"typeName",label:l(m)("createTable.typeName"),"show-overflow-tooltip":""},{default:t(e=>[a(H,{modelValue:e.row.typeName,"onUpdate:modelValue":u=>e.row.typeName=u,placeholder:l(m)("createTable.typeName"),clearable:"",filterable:""},{default:t(()=>[(V(!0),k(I,null,C(l(U),u=>(V(),x(G,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["label"]),a(p,{prop:"precision",label:l(m)("createTable.precision"),"show-overflow-tooltip":""},{default:t(e=>[a(D,{min:0,max:1e4,modelValue:e.row.precision,"onUpdate:modelValue":u=>e.row.precision=u,placeholder:l(m)("createTable.precision")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["label"]),a(p,{prop:"scale",label:l(m)("createTable.scale"),"show-overflow-tooltip":""},{default:t(e=>[a(D,{min:0,max:1e4,modelValue:e.row.scale,"onUpdate:modelValue":u=>e.row.scale=u,placeholder:l(m)("createTable.scale")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["label"]),a(p,{prop:"defaultValue",label:l(m)("createTable.defaultValue"),"show-overflow-tooltip":""},{default:t(e=>[a(s,{modelValue:e.row.defaultValue,"onUpdate:modelValue":u=>e.row.defaultValue=u,placeholder:l(m)("createTable.defaultValue")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["label"]),a(p,{prop:"primary",label:l(m)("createTable.primary"),"show-overflow-tooltip":""},{default:t(e=>[a(J,{modelValue:e.row.primary,"onUpdate:modelValue":u=>e.row.primary=u},{default:t(()=>[(V(),k(I,null,C(q,(u,d)=>a(E,{key:d,label:u.value,class:"w-5"},{default:t(()=>[g(_(u.label),1)]),_:2},1032,["label"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(p,{prop:"nullable",label:l(m)("createTable.nullable"),"show-overflow-tooltip":""},{default:t(e=>[a(J,{modelValue:e.row.nullable,"onUpdate:modelValue":u=>e.row.nullable=u},{default:t(()=>[(V(),k(I,null,C(q,(u,d)=>a(E,{key:d,label:u.value,class:"w-5"},{default:t(()=>[g(_(u.label),1)]),_:2},1032,["label"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])),[[Z,l(h)]])]),_:2},[l(N)!=="view"?{name:"footer",fn:t(()=>[se("span",be,[a(w,{onClick:r[2]||(r[2]=e=>y.value=!1)},{default:t(()=>[g(_(n.$t("common.cancelButtonText")),1)]),_:1}),a(w,{type:"primary",onClick:j,disabled:l(h)},{default:t(()=>[g(_(n.$t("common.confirmButtonText")),1)]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["title","modelValue"])}}});export{ye as default};
