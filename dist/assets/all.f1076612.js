import{l as X,r,aq as Y,h as Z,R as ee,as as te,aa as g,ah as le,m as y,q as _,t as n,K as q,$ as V,y as M,u as t,J as k,L as a,E as o,I as $,F as S,M as J,D as O,H as D,j as ae}from"./vue.4dfaac09.js";import{au as se,e as L,av as ie,o as oe}from"./index.0f5ebb0a.js";import{g as re,a as ne}from"./index.943ec589.js";import ue from"./step1.83a3c2c5.js";import{_ as pe}from"./step2.vue_vue_type_style_index_0_lang.bfb67666.js";import ce from"./step3.cc968124.js";import{u as me}from"./flow.3bb50ae4.js";import"./index.e40e0854.js";import"./nodeWrap.a8dcddc1.js";import"./addNode.0fb2f482.js";import"./const.5d8c27a7.js";import"./index.28ce57ef.js";import"./index.26cedbc4.js";import"./promoterDrawer.6fdb2b34.js";import"./formPerm.46023bcb.js";import"./approverDrawer.vue_vue_type_script_setup_true_lang.78a2dee7.js";import"./eventConfig.vue_vue_type_script_setup_true_lang.8b6c4ce3.js";import"./formPermissions.b77839a8.js";import"./copyerDrawer.52e31f0b.js";import"./conditionDrawer.6b80bb41.js";import"./condition.7a8b7b0e.js";const fe={class:"layout-padding"},de={class:"layout-padding-auto layout-padding-view"},ve={class:"flex justify-between items-center px-5 py-3 mb-2 h-15"},ge=n("div",{class:"flex-1"},null,-1),ye={class:"flex-2 text-center max-w-[600px]"},be=["onClick"],ke={class:"text-lg font-medium"},he={class:"flex flex-1 justify-end items-center"},xe={class:"text-center"},we={class:"inline-block w-25 h-25"},Ie=X({__name:"all",setup(_e){let s=me();const j=r(),N=r(),C=r(),m=r([]),f=r(0),c=r(0),d=r(!1),h=r(!1),x=r(!1),B=()=>{f.value=c.value,d.value=!1},E=e=>{m.value=[],c.value=0,d.value=!0,h.value=!0,setTimeout(function(){H()},500)},F=Y();Z(()=>{const e=F.query,l=e.groupId??"",u=e.flowId??"",p=e.cp??"";if(l&&(T.value=l),u)re(u).then(v=>{var{data:i}=v;s.step1.adminList=JSON.parse(i.adminList),s.step1.name=i.name,s.step1.logo=i.logo,p&&parseInt(p)===1||(s.step1.flowId=u),s.step1.remark=i.remark,s.step1.groupId=i.groupId,s.setStep2(se.formCreate.parseJson(i.formItems)),R=JSON.parse(i.process)});else{let v=L().userInfos.user.userId,i=L().userInfos.user.username,w=L().userInfos.user.avatar;s.clearStep1(),s.clearStep2(),s.step1.adminList=[{id:v,name:i,avatar:w,type:"user"}]}});let R=ee({});var T=r();const H=()=>{j.value.validate(function(e,l){e?(c.value=1,setTimeout(function(){K()},500)):(h.value=!1,m.value=l)})},K=()=>{N.value.validate(function(e,l){e?setTimeout(function(){c.value=2,P()}):(h.value=!1,m.value=l)})},P=()=>{setTimeout(function(){C.value.validate(function(e,l){e?c.value=3:(h.value=!1,m.value=l)})})},U=te(),z=()=>{x.value||(x.value=!0,C.value.getProcessData().then(e=>{let l=s.step1,u=s.step2,p=oe.deepClone(l);p.formItems=JSON.stringify(u),p.process=JSON.stringify(e),p.adminList=JSON.stringify(l.adminList),ne(p).then(()=>{d.value=!1,s.$reset(),U.push("/flow/list/index")}).catch(()=>{x.value=!1})}).catch(()=>{x.value=!1}))},A=[{title:"flow.basicInformation"},{title:"flow.formDesign"},{title:"flow.processDesign"}];return(e,l)=>{const u=g("el-button"),p=g("el-scrollbar"),v=g("el-step"),i=g("el-steps"),w=g("el-result"),G=g("el-icon"),Q=g("el-dialog"),W=le("loading");return y(),_("div",fe,[n("div",de,[n("div",ve,[ge,n("div",ye,[(y(),_(q,null,V(A,(b,I)=>n("span",{key:I,class:M(["inline-block px-5 py-2.5 cursor-pointer",{"border-b-2 border-primary text-primary":t(f)===I}]),onClick:$e=>f.value=I},[n("span",{class:M(["mr-1.5 inline-block w-6 h-6 text-base font-normal text-center leading-[22px] border rounded-full",[t(f)===I?"bg-primary text-white":"border-current"]])},k(I+1),3),n("span",ke,k(e.$t(b.title)),1)],10,be)),64))]),n("div",he,[a(u,{type:"primary",onClick:E},{default:o(()=>[$(k(e.$t("flow.publish")),1)]),_:1})])]),a(p,{class:"h-[calc(100vh-20px)]"},{default:o(()=>[S(a(ue,{groupId:t(T),ref_key:"step1Ref",ref:j},null,8,["groupId"]),[[J,t(f)===0]]),S(a(pe,{ref_key:"step2Ref",ref:N},null,512),[[J,t(f)===1]]),S(a(ce,{nodeConfigObj:t(R),ref_key:"step3Ref",ref:C},null,8,["nodeConfigObj"]),[[J,t(f)===2]])]),_:1}),a(Q,{modelValue:t(d),"onUpdate:modelValue":l[0]||(l[0]=b=>ae(d)?d.value=b:null),title:e.$t("flow.processCheck")},{default:o(()=>[a(i,{active:t(c),"finish-status":"success",simple:"",class:"mt-5"},{default:o(()=>[a(v,{title:e.$t("flow.basicInformation")},null,8,["title"]),a(v,{title:e.$t("flow.formDesign")},null,8,["title"]),a(v,{title:e.$t("flow.processDesign")},null,8,["title"])]),_:1},8,["active"]),n("div",xe,[t(c)===3?(y(),O(w,{key:0,icon:"success",title:e.$t("flow.checkSuccess"),"sub-title":e.$t("flow.checkSubSuccess")},{extra:o(()=>[a(u,{type:"primary",loading:t(x),onClick:z},{default:o(()=>[$(k(e.$t("flow.submit")),1)]),_:1},8,["loading"])]),_:1},8,["title","sub-title"])):D("",!0),t(m).length===0&&t(d)&&t(h)&&t(c)<3?(y(),O(w,{key:1,title:e.$t("flow.checkIng"),"sub-title":e.$t("flow.checkSubIng")},{icon:o(()=>[S(n("span",we,null,512),[[W,!0]])]),_:1},8,["title","sub-title"])):D("",!0),t(m).length>0?(y(),O(w,{key:2,icon:"error",title:"\u68C0\u67E5\u5931\u8D25"},{"sub-title":o(()=>[(y(!0),_(q,null,V(t(m),b=>(y(),_("div",{key:b,class:"text-red-500"},[a(G,null,{default:o(()=>[a(t(ie))]),_:1}),$(" "+k(b),1)]))),128))]),extra:o(()=>[a(u,{type:"primary",onClick:B},{default:o(()=>[$(k(e.$t("common.editBtn")),1)]),_:1})]),_:1})):D("",!0)])]),_:1},8,["modelValue","title"])])])}}});export{Ie as default};
