import{s as Y}from"./const.5d8c27a7.js";import{u as Z}from"./index.26cedbc4.js";import{u as ee}from"./flow.3bb50ae4.js";import le from"./formPerm.46023bcb.js";import{_ as ae}from"./eventConfig.vue_vue_type_script_setup_true_lang.8b6c4ce3.js";import{v as w,o as se,aw as E}from"./index.0f5ebb0a.js";import{p as oe}from"./formPermissions.b77839a8.js";import{l as te,a as k,r as de,e as H,aa as g,m as u,D as V,E as r,L as o,u as l,q as y,K as c,$ as S,I as m,J as re,H as v,t as p,j as ne}from"./vue.4dfaac09.js";const ue=p("h4",null,"\u9009\u62E9\u90E8\u95E8",-1),ie=p("h4",null,"\u9009\u62E9\u89D2\u8272",-1),pe=p("h4",null,"\u9009\u62E9\u6210\u5458",-1),me=p("h4",null,"\u4EBA\u5458\u63A7\u4EF6",-1),fe=p("h4",null,"\u5BA1\u6279\u7EC8\u70B9",-1),ge=p("span",{style:{"margin-right":"5px","font-size":"14px"}},"\u5230\u7B2C",-1),ye=p("span",{style:{"margin-left":"5px","font-size":"14px"}},"\u7EA7\u90E8\u95E8\u4E3B\u7BA1\u7EC8\u6B62",-1),ce=p("h4",null,"\u9009\u62E9\u65B9\u5F0F",-1),ve=p("h4",null,"\u591A\u4EBA\u5BA1\u6279\u65F6\u91C7\u7528\u7684\u5BA1\u6279\u65B9\u5F0F",-1),_e={style:{display:"block",width:"100%"}},be={style:{display:"block",width:"100%"}},he={style:{display:"block",width:"100%"}},Ue=p("h4",null,"\u5BA1\u6279\u4EBA\u4E3A\u7A7A\u65F6",-1),Ve=p("h4",null,"\u5BA1\u6279\u88AB\u62D2\u7EDD",-1),Le=te({__name:"approverDrawer",setup(Te){let C=ee();const D=k(()=>{let d=[];const a=[1],t={},i={};z(void 0,C.step3,t,i,!0);const h=t[e.value.id];if(h==null)return[];for(const n of h){const _=i[n].type;a.indexOf(_)>-1&&i[n].id!=e.value.id&&d.push({id:i[n].id,name:i[n].nodeName})}return d});function z(d,a,t,i,h){if(w(a==null?void 0:a.id))return;const n=a.id;if(i[n]=a,w(d)){const b=[];b.push(n),t[n]=b}else{const b=t[d];let L=i[d].type;if(L!=5&&L!=8||h){const T=se.deepClone(b);T.push(n),t[n]=T}else t[n]=[]}const _=a.type,f=a.childNode;if(_===5||_===8||_===4){const b=a.conditionNodes;for(const L of b)z(n,L,t,i,!1);w(f==null?void 0:f.id)||z(n,f,t,i,!0)}else w(f==null?void 0:f.id)||z(n,f,t,i,!0)}const I=k(()=>C.step2),N=k(()=>I.value.filter(d=>{var a;return d.type==="OrgSelector"&&((a=d.props)==null?void 0:a.type)==="user"})),J=()=>{let d=I.value,a=e.value.formPerms||{};for(const t of d)a[t.field]||(a[t.field]="R");e.value.formPerms=a,(()=>{const t=I.value;oe(t,e.value.formPerms||{})})()};let e=de({}),x=Z(),{setApproverConfig:j,setApprover:F}=x,P=k(()=>x.approverConfigData),G=k(()=>x.approverDrawer),O=k({get:()=>G.value,set(){R()}});H(P,d=>{e.value=d.value}),H(()=>e.value.formUserId,d=>{d&&(e.value.formUserName=N.value.filter(a=>a.field===d)[0].field)});const K=()=>{e.value.nodeUserList=[]},$=()=>{e.value.error=!B(e.value),j({value:e.value,flag:!0,id:P.value.id}),R()},R=()=>{F(!1)},B=d=>{var i;if(d.assignedType==1||d.assignedType==3){if(d.nodeUserList.length==0)return!1}else if(d.assignedType==8&&d.formUserId.length==0)return!1;if(((i=d==null?void 0:d.nobody)==null?void 0:i.handler)==="TO_USER"&&d.nobody.assignedUser.length===0)return!1;let a=d.operList;return(a==null?void 0:a.filter(h=>h.checked).length)!=0};return(d,a)=>{const t=g("el-radio"),i=g("el-col"),h=g("el-row"),n=g("el-radio-group"),_=g("el-divider"),f=g("el-option"),b=g("el-select"),L=g("el-input-number"),T=g("el-tab-pane"),Q=g("el-tabs"),W=g("el-drawer");return u(),V(W,{modelValue:l(O),"onUpdate:modelValue":a[13]||(a[13]=U=>ne(O)?O.value=U:O=U),"append-to-body":!0,title:"\u5BA1\u6279\u4EBA\u8BBE\u7F6E","show-close":!1,size:550,"before-close":$,onOpen:J},{default:r(()=>[o(Q,{type:"border-card"},{default:r(()=>[o(T,{label:"\u8BBE\u7F6E\u5BA1\u6279\u4EBA"},{default:r(()=>{var A,q,M;return[o(n,{modelValue:l(e).assignedType,"onUpdate:modelValue":a[0]||(a[0]=s=>l(e).assignedType=s),class:"ml-4",onChange:K},{default:r(()=>[o(h,null,{default:r(()=>[(u(!0),y(c,null,S(l(Y),({value:s,label:X})=>(u(),V(i,{key:s,span:8},{default:r(()=>[o(t,{label:s},{default:r(()=>[m(re(X),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"]),o(_),l(e).assignedType===2?(u(),y(c,{key:0},[ue,o(E,{orgList:l(e).nodeUserList,"onUpdate:orgList":a[1]||(a[1]=s=>l(e).nodeUserList=s),type:"dept"},null,8,["orgList"])],64)):v("",!0),l(e).assignedType===3?(u(),y(c,{key:1},[ie,o(E,{orgList:l(e).nodeUserList,"onUpdate:orgList":a[2]||(a[2]=s=>l(e).nodeUserList=s),type:"role",multiple:!0},null,8,["orgList"])],64)):v("",!0),l(e).assignedType===1?(u(),y(c,{key:2},[pe,o(E,{orgList:l(e).nodeUserList,"onUpdate:orgList":a[3]||(a[3]=s=>l(e).nodeUserList=s),type:"user",multiple:!0},null,8,["orgList"])],64)):v("",!0),l(e).assignedType===8?(u(),y(c,{key:3},[me,o(b,{modelValue:l(e).formUserId,"onUpdate:modelValue":a[4]||(a[4]=s=>l(e).formUserId=s),clearable:"",class:"m-2",placeholder:"\u8BF7\u9009\u62E9\u5BA1\u6279\u8868\u5355",size:"large"},{default:r(()=>[(u(!0),y(c,null,S(l(N),s=>(u(),V(f,{key:s.field,label:s.title,value:s.field},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])],64)):v("",!0),l(e).assignedType===7?(u(),y(c,{key:4},[fe,ge,o(L,{modelValue:l(e).deptLeaderLevel,"onUpdate:modelValue":a[5]||(a[5]=s=>l(e).deptLeaderLevel=s),step:1,min:1,max:20,"step-strictly":"",size:"small"},null,8,["modelValue"]),ye],64)):v("",!0),l(e).assignedType===4?(u(),y(c,{key:5},[ce,o(n,{modelValue:l(e).multiple,"onUpdate:modelValue":a[6]||(a[6]=s=>l(e).multiple=s),class:"ml-4"},{default:r(()=>[o(t,{label:!1,size:"large"},{default:r(()=>[m("\u5355\u9009")]),_:1}),o(t,{label:!0,size:"large"},{default:r(()=>[m("\u591A\u9009")]),_:1})]),_:1},8,["modelValue"])],64)):v("",!0),(l(e).multiple===!0&&l(e).assignedType===4||l(e).assignedType===1&&l(e).nodeUserList.length>1||l(e).assignedType===2||l(e).assignedType===3||l(e).assignedType===7&&l(e).deptLeaderLevel>1||l(e).assignedType===8&&(U=l(e).formUserId,U&&((A=N.value.filter(s=>s.id===U)[0])==null?void 0:A.props.multiple)))&&l(e).assignedType!==5?(u(),y(c,{key:6},[ve,o(n,{modelValue:l(e).multipleMode,"onUpdate:modelValue":a[7]||(a[7]=s=>l(e).multipleMode=s),class:"ml-4"},{default:r(()=>[p("p",_e,[o(t,{label:1,size:"large"},{default:r(()=>[m("\u4F1A\u7B7E(\u9700\u8981\u6240\u6709\u5BA1\u6279\u4EBA\u540C\u610F)")]),_:1})]),p("p",be,[o(t,{label:2,size:"large"},{default:r(()=>[m("\u6216\u7B7E(\u4E00\u540D\u5BA1\u6279\u4EBA\u540C\u610F\u5373\u53EF)")]),_:1})]),p("p",he,[o(t,{label:3,size:"large"},{default:r(()=>[m("\u4F9D\u6B21\u5BA1\u6279(\u6309\u987A\u5E8F\u4F9D\u6B21\u5BA1\u6279)")]),_:1})])]),_:1},8,["modelValue"])],64)):v("",!0),o(_),Ue,o(n,{modelValue:l(e).nobody.handler,"onUpdate:modelValue":a[8]||(a[8]=s=>l(e).nobody.handler=s),class:"ml-4"},{default:r(()=>[o(t,{label:"TO_PASS",size:"large"},{default:r(()=>[m("\u81EA\u52A8\u901A\u8FC7")]),_:1}),o(t,{label:"TO_REFUSE",size:"large"},{default:r(()=>[m("\u81EA\u52A8\u62D2\u7EDD")]),_:1}),o(t,{label:"TO_END",size:"large"},{default:r(()=>[m("\u81EA\u52A8\u7ED3\u675F")]),_:1}),o(t,{label:"TO_ADMIN",size:"large"},{default:r(()=>[m("\u8F6C\u4EA4\u7ED9\u7BA1\u7406\u5458")]),_:1}),o(t,{label:"TO_USER",size:"large"},{default:r(()=>[m("\u6307\u5B9A\u4EBA\u5458")]),_:1})]),_:1},8,["modelValue"]),((q=l(e))==null?void 0:q.nobody.handler)==="TO_USER"?(u(),V(E,{key:7,orgList:l(e).nobody.assignedUser,"onUpdate:orgList":a[9]||(a[9]=s=>l(e).nobody.assignedUser=s),type:"user",multiple:!1},null,8,["orgList"])):v("",!0),o(_),(M=l(e).refuse)!=null&&M.handler?(u(),y(c,{key:8},[Ve,o(n,{modelValue:l(e).refuse.handler,"onUpdate:modelValue":a[10]||(a[10]=s=>l(e).refuse.handler=s),class:"ml-4"},{default:r(()=>[o(t,{label:"TO_END",size:"large"},{default:r(()=>[m("\u76F4\u63A5\u7ED3\u675F\u6D41\u7A0B")]),_:1}),l(D).length>0?(u(),V(t,{key:0,label:"TO_NODE",size:"large"},{default:r(()=>[m("\u9A73\u56DE\u5230\u6307\u5B9A\u8282\u70B9")]),_:1})):v("",!0)]),_:1},8,["modelValue"]),l(e).refuse.handler==="TO_NODE"&&l(D).length>0?(u(),V(b,{key:0,modelValue:l(e).refuse.nodeId,"onUpdate:modelValue":a[11]||(a[11]=s=>l(e).refuse.nodeId=s),placeholder:"\u9A73\u56DE\u8282\u70B9",class:"mb-2 w-1/2"},{default:r(()=>[(u(!0),y(c,null,S(l(D),s=>(u(),V(f,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):v("",!0)],64)):v("",!0)];var U}),_:1}),o(T,{label:"\u8868\u5355\u6743\u9650"},{default:r(()=>[o(le,{"form-perm":l(e).formPerms},null,8,["form-perm"])]),_:1}),o(T,{label:"\u4E8B\u4EF6\u901A\u77E5"},{default:r(()=>[o(ae,{modelValue:l(e).eventConfig,"onUpdate:modelValue":a[12]||(a[12]=U=>l(e).eventConfig=U)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});export{Le as _};
